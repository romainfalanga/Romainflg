var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertyNames,n=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(t,s,r)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,l=(e,t)=>{for(var s in t||(t={}))i.call(t,s)&&a(e,s,t[s]);if(n)for(var s of n(t))o.call(t,s)&&a(e,s,t[s]);return e},c=(e,r)=>t(e,s(r)),u=(e,t,s)=>new Promise((r,n)=>{var i=e=>{try{a(s.next(e))}catch(t){n(t)}},o=e=>{try{a(s.throw(e))}catch(t){n(t)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(i,o);a((s=s.apply(e,t)).next())});import{r as d,a as h,g as p,c as m,R as f}from"./vendor-DBR9_dkd.js";import{X as g,U as v,M as b,L as y,a as x,b as w,H as _,c as j,E as k,K as S,C as N,A as T,S as E,d as P,e as C,f as O,g as A,h as I,i as R,P as $,j as U,k as L}from"./icons-Bp5aVpc2.js";import{L as D,u as q,B as M,R as z,a as B}from"./router-BJi671pE.js";var F,J,W=(F={"assets/js/index-Dd0VSkd-.js"(e){!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var t={exports:{}},s={},r=d,n=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,F={key:!0,ref:!0,__self:!0,__source:!0};function J(e,t,s){var r,i={},l=null,c=null;for(r in void 0!==s&&(l=""+s),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,r)&&!F.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:n,type:e,key:l,ref:c,props:i,_owner:a.current}}s.Fragment=i,s.jsx=J,s.jsxs=J,t.exports=s;var W,K=t.exports,V=h;W=V.createRoot,V.hydrateRoot;const G=d.createContext(void 0);function H({children:e}){const[t,s]=d.useState([]),[r,n]=d.useState(!0);d.useEffect(()=>{i(),n(!1)},[]);const i=()=>{localStorage.removeItem("projects");const e=[{id:"1",slug:"chess-value",name:"Chess Value",description:"Chess Value évalue en temps réel la valeur des pièces selon la position, pour analyser et améliorer vos stratégies aux échecs.",fullDescription:"Chess Value évalue en temps réel la valeur des pièces selon la position, pour analyser et améliorer vos stratégies aux échecs.",websiteUrl:"https://chess-value.com",wedogoodUrl:"https://wedogood.co/projects/chessvalue",telegramUrl:"https://t.me/ChessValue",image:"/logos/ChessValue.png",cm1:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10},cm2:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10},cm3:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10}},{id:"2",slug:"chess-13",name:"Chess 13",description:"Un plateau de 13 x 13. Un attaquant aux bords, un défenseur au centre. Préparez votre stratégie positionnel et matez votre adversaire !",fullDescription:"Un plateau de 13 x 13. Un attaquant aux bords, un défenseur au centre. Préparez votre stratégie positionnel et matez votre adversaire !",websiteUrl:"https://chess-13.com",wedogoodUrl:"https://wedogood.co/projects/chess13",telegramUrl:"https://t.me/Chess13Game",image:"/logos/Chess13.png",cm1:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10},cm2:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10},cm3:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10}},{id:"3",slug:"chess-100",name:"Chess 100",description:"Atteignez la 100e rangée sur un plateau 100 x 8. Créez vos parcours, relevez ceux des autres et devenez le plus rapide.",fullDescription:"Atteignez la 100e rangée sur un plateau 100 x 8. Créez vos parcours, relevez ceux des autres et devenez le plus rapide.",websiteUrl:"https://chess-100.com",wedogoodUrl:"https://wedogood.co/projects/chess100",telegramUrl:"https://t.me/Chess100Game",image:"/logos/Chess100.png",cm1:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10},cm2:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10},cm3:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10}},{id:"4",slug:"draft-chess",name:"Draft Chess",description:"L'échiquier où la partie commence avant le premier coup, en plaçant vos pièces tour à tour avec votre adversaire",fullDescription:"L'échiquier où la partie commence avant le premier coup, en plaçant vos pièces tour à tour avec votre adversaire",websiteUrl:"https://draft-chess.com",wedogoodUrl:"https://wedogood.co/projects/draftchess",telegramUrl:"https://t.me/DraftChessGame",image:"/logos/DraftChess.png",cm1:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10},cm2:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10},cm3:{name:"Recherche active",email:"",tiktokAccount:"",percentage:10}}];s(e),localStorage.setItem("projects",JSON.stringify(e))};return K.jsx(G.Provider,{value:{projects:t,loading:r,addProject:e=>{const r=[l({id:Date.now().toString()},e),...t];s(r),localStorage.setItem("projects",JSON.stringify(r))},updateProject:(e,r)=>{const n=t.map(t=>t.id===e?l(l({},t),r):t);s(n),localStorage.setItem("projects",JSON.stringify(n))},deleteProject:e=>{const r=t.filter(t=>t.id!==e);s(r),localStorage.setItem("projects",JSON.stringify(r))}},children:e})}const Y=()=>{const e=d.useContext(G);if(void 0===e)throw new Error("useData must be used within a DataProvider");return e},Z={},X=function(e,t,s){let r=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),s=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));r=Promise.allSettled(t.map(e=>{if((e=function(e){return"/"+e}(e))in Z)return;Z[e]=!0;const t=e.endsWith(".css"),r=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${r}`))return;const n=document.createElement("link");return n.rel=t?"stylesheet":"modulepreload",t||(n.as="script"),n.crossOrigin="",n.href=e,s&&n.setAttribute("nonce",s),document.head.appendChild(n),t?new Promise((t,s)=>{n.addEventListener("load",t),n.addEventListener("error",()=>s(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function n(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return r.then(t=>{for(const e of t||[])"rejected"===e.status&&n(e.reason);return e().catch(n)})};class Q extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class ee extends Q{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class te extends Q{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class se extends Q{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var re,ne;(ne=re||(re={})).Any="any",ne.ApNortheast1="ap-northeast-1",ne.ApNortheast2="ap-northeast-2",ne.ApSouth1="ap-south-1",ne.ApSoutheast1="ap-southeast-1",ne.ApSoutheast2="ap-southeast-2",ne.CaCentral1="ca-central-1",ne.EuCentral1="eu-central-1",ne.EuWest1="eu-west-1",ne.EuWest2="eu-west-2",ne.EuWest3="eu-west-3",ne.SaEast1="sa-east-1",ne.UsEast1="us-east-1",ne.UsWest1="us-west-1",ne.UsWest2="us-west-2";var ie=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};class oe{constructor(t,{headers:s={},customFetch:r,region:n=re.Any}={}){this.url=t,this.headers=s,this.region=n,this.fetch=(t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>X(()=>u(e,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ye);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return ie(this,void 0,void 0,function*(){try{const{headers:r,method:n,body:i}=t;let o={},{region:a}=t;a||(a=this.region);const l=new URL(`${this.url}/${e}`);let c;a&&"any"!==a&&(o["x-region"]=a,l.searchParams.set("forceFunctionRegion",a)),i&&(r&&!Object.prototype.hasOwnProperty.call(r,"Content-Type")||!r)&&("undefined"!=typeof Blob&&i instanceof Blob||i instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",c=i):"string"==typeof i?(o["Content-Type"]="text/plain",c=i):"undefined"!=typeof FormData&&i instanceof FormData?c=i:(o["Content-Type"]="application/json",c=JSON.stringify(i)));const u=yield this.fetch(l.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),r),body:c}).catch(e=>{throw new ee(e)}),d=u.headers.get("x-relay-error");if(d&&"true"===d)throw new te(u);if(!u.ok)throw new se(u);let h,p=(null!==(s=u.headers.get("Content-Type"))&&void 0!==s?s:"text/plain").split(";")[0].trim();return h="application/json"===p?yield u.json():"application/octet-stream"===p?yield u.blob():"text/event-stream"===p?u:"multipart/form-data"===p?yield u.formData():yield u.text(),{data:h,error:null,response:u}}catch(r){return{data:null,error:r,response:r instanceof se||r instanceof te?r.context:void 0}}})}}var ae={},le={},ce={},ue={},de={},he={},pe=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();const me=pe.fetch,fe=pe.fetch.bind(pe),ge=pe.Headers,ve=pe.Request,be=pe.Response,ye=Object.freeze(Object.defineProperty({__proto__:null,Headers:ge,Request:ve,Response:be,default:fe,fetch:me},Symbol.toStringTag,{value:"Module"})),xe=p(ye);var we={};Object.defineProperty(we,"__esModule",{value:!0});let _e=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};we.default=_e;var je=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(he,"__esModule",{value:!0});const ke=je(xe),Se=je(we);he.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"undefined"==typeof fetch?this.fetch=ke.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(e=>u(this,null,function*(){var t,s,r;let n=null,i=null,o=null,a=e.status,l=e.statusText;if(e.ok){if("HEAD"!==this.method){const t=yield e.text();""===t||(i="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}const r=null===(t=this.headers.Prefer)||void 0===t?void 0:t.match(/count=(exact|planned|estimated)/),c=null===(s=e.headers.get("content-range"))||void 0===s?void 0:s.split("/");r&&c&&c.length>1&&(o=parseInt(c[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(i)&&(i.length>1?(n={code:"PGRST116",details:`Results contain ${i.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},i=null,o=null,a=406,l="Not Acceptable"):i=1===i.length?i[0]:null)}else{const t=yield e.text();try{n=JSON.parse(t),Array.isArray(n)&&404===e.status&&(i=[],n=null,a=200,l="OK")}catch(c){404===e.status&&""===t?(a=204,l="No Content"):n={message:t}}if(n&&this.isMaybeSingle&&(null===(r=null==n?void 0:n.details)||void 0===r?void 0:r.includes("0 rows"))&&(n=null,a=200,l="OK"),n&&this.shouldThrowOnError)throw new Se.default(n)}return{error:n,data:i,count:o,status:a,statusText:l}}));return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,r;return{error:{message:`${null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!==(s=null==e?void 0:e.stack)&&void 0!==s?s:""}`,hint:"",code:`${null!==(r=null==e?void 0:e.code)&&void 0!==r?r:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};var Ne=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(de,"__esModule",{value:!0});const Te=Ne(he);let Ee=class extends Te.default{select(e){let t=!1;const s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:n=r}={}){const i=n?`${n}.order`:"order",o=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${o?`${o},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){const n=void 0===r?"offset":`${r}.offset`,i=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(i,""+(t-e+1)),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:n=!1,format:i="text"}={}){var o;const a=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=null!==(o=this.headers.Accept)&&void 0!==o?o:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${i}; for="${l}"; options=${a};`,this}rollback(){var e;return(null!==(e=this.headers.Prefer)&&void 0!==e?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};de.default=Ee;var Pe=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ue,"__esModule",{value:!0});const Ce=Pe(de);let Oe=class extends Ce.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(e=>"string"==typeof e&&new RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let n="";"plain"===r?n="pl":"phrase"===r?n="ph":"websearch"===r&&(n="w");const i=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${i}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};ue.default=Oe;var Ae=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ce,"__esModule",{value:!0});const Ie=Ae(ue);ce.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){const r=t?"HEAD":"GET";let n=!1;const i=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!n?"":('"'===e&&(n=!n),e)).join("");return this.url.searchParams.set("select",i),s&&(this.headers.Prefer=`count=${s}`),new Ie.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Ie.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:n=!0}={}){const i=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&i.push(this.headers.Prefer),r&&i.push(`count=${r}`),n||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(e)){const t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){const e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new Ie.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new Ie.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new Ie.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};var Re={},$e={};Object.defineProperty($e,"__esModule",{value:!0}),$e.version=void 0,$e.version="0.0.0-automated",Object.defineProperty(Re,"__esModule",{value:!0}),Re.DEFAULT_HEADERS=void 0;const Ue=$e;Re.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Ue.version}`};var Le=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(le,"__esModule",{value:!0});const De=Le(ce),qe=Le(ue),Me=Re;le.default=class e{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},Me.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){const t=new URL(`${this.url}/${e}`);return new De.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(t){return new e(this.url,{headers:this.headers,schema:t,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:n}={}){let i;const o=new URL(`${this.url}/rpc/${e}`);let a;s||r?(i=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{o.searchParams.append(e,t)})):(i="POST",a=t);const l=Object.assign({},this.headers);return n&&(l.Prefer=`count=${n}`),new qe.default({method:i,url:o,headers:l,schema:this.schemaName,body:a,fetch:this.fetch,allowEmpty:!1})}};var ze=m&&m.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(ae,"__esModule",{value:!0}),ae.PostgrestError=ae.PostgrestBuilder=ae.PostgrestTransformBuilder=ae.PostgrestFilterBuilder=ae.PostgrestQueryBuilder=ae.PostgrestClient=void 0;const Be=ze(le);ae.PostgrestClient=Be.default;const Fe=ze(ce);ae.PostgrestQueryBuilder=Fe.default;const Je=ze(ue);ae.PostgrestFilterBuilder=Je.default;const We=ze(de);ae.PostgrestTransformBuilder=We.default;const Ke=ze(he);ae.PostgrestBuilder=Ke.default;const Ve=ze(we);ae.PostgrestError=Ve.default;var Ge=ae.default={PostgrestClient:Be.default,PostgrestQueryBuilder:Fe.default,PostgrestFilterBuilder:Je.default,PostgrestTransformBuilder:We.default,PostgrestBuilder:Ke.default,PostgrestError:Ve.default};const{PostgrestClient:He,PostgrestQueryBuilder:Ye,PostgrestFilterBuilder:Ze,PostgrestTransformBuilder:Xe,PostgrestBuilder:Qe,PostgrestError:et}=Ge;class tt{static detectEnvironment(){var e;if("undefined"!=typeof WebSocket)return{type:"native",constructor:WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocket)return{type:"native",constructor:globalThis.WebSocket};if("undefined"!=typeof global&&void 0!==global.WebSocket)return{type:"native",constructor:global.WebSocket};if("undefined"!=typeof globalThis&&void 0!==globalThis.WebSocketPair&&void 0===globalThis.WebSocket)return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if("undefined"!=typeof globalThis&&globalThis.EdgeRuntime||"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if("undefined"!=typeof process&&process.versions&&process.versions.node){const e=parseInt(process.versions.node.split(".")[0]);return e>=22?void 0!==globalThis.WebSocket?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${e} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${e} detected without native WebSocket support.`,workaround:'For Node.js < 22, install "ws" package and provide it via the transport option:\nimport ws from "ws"\nnew RealtimeClient(url, { transport: ws })'}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`\n\nSuggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){return new(this.getWebSocketConstructor())(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return"native"===e.type||"ws"===e.type}catch(e){return!1}}}const st=1e4;var rt,nt,it,ot,at,lt,ct,ut,dt,ht,pt;(nt=rt||(rt={}))[nt.connecting=0]="connecting",nt[nt.open=1]="open",nt[nt.closing=2]="closing",nt[nt.closed=3]="closed",(ot=it||(it={})).closed="closed",ot.errored="errored",ot.joined="joined",ot.joining="joining",ot.leaving="leaving",(lt=at||(at={})).close="phx_close",lt.error="phx_error",lt.join="phx_join",lt.reply="phx_reply",lt.leave="phx_leave",lt.access_token="access_token",(ct||(ct={})).websocket="websocket",(dt=ut||(ut={})).Connecting="connecting",dt.Open="open",dt.Closing="closing",dt.Closed="closed";class mt{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t("string"==typeof e?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const r=t.getUint8(1),n=t.getUint8(2);let i=this.HEADER_LENGTH+2;const o=s.decode(e.slice(i,i+r));i+=r;const a=s.decode(e.slice(i,i+n));return i+=n,{ref:null,topic:o,event:a,payload:JSON.parse(s.decode(e.slice(i,e.byteLength)))}}}class ft{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(pt=ht||(ht={})).abstime="abstime",pt.bool="bool",pt.date="date",pt.daterange="daterange",pt.float4="float4",pt.float8="float8",pt.int2="int2",pt.int4="int4",pt.int4range="int4range",pt.int8="int8",pt.int8range="int8range",pt.json="json",pt.jsonb="jsonb",pt.money="money",pt.numeric="numeric",pt.oid="oid",pt.reltime="reltime",pt.text="text",pt.time="time",pt.timestamp="timestamp",pt.timestamptz="timestamptz",pt.timetz="timetz",pt.tsrange="tsrange",pt.tstzrange="tstzrange";const gt=(e,t,s={})=>{var r;const n=null!==(r=s.skipTypes)&&void 0!==r?r:[];return Object.keys(t).reduce((s,r)=>(s[r]=vt(r,e,t,n),s),{})},vt=(e,t,s,r)=>{const n=t.find(t=>t.name===e),i=null==n?void 0:n.type,o=s[e];return i&&!r.includes(i)?bt(i,o):yt(o)},bt=(e,t)=>{if("_"===e.charAt(0)){const s=e.slice(1,e.length);return jt(t,s)}switch(e){case ht.bool:return xt(t);case ht.float4:case ht.float8:case ht.int2:case ht.int4:case ht.int8:case ht.numeric:case ht.oid:return wt(t);case ht.json:case ht.jsonb:return _t(t);case ht.timestamp:return kt(t);case ht.abstime:case ht.date:case ht.daterange:case ht.int4range:case ht.int8range:case ht.money:case ht.reltime:case ht.text:case ht.time:case ht.timestamptz:case ht.timetz:case ht.tsrange:case ht.tstzrange:default:return yt(t)}},yt=e=>e,xt=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},wt=e=>{if("string"==typeof e){const t=parseFloat(e);if(!Number.isNaN(t))return t}return e},_t=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(t){return console.log(`JSON parse error: ${t}`),e}return e},jt=(e,t)=>{if("string"!=typeof e)return e;const s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r;const i=e.slice(1,s);try{r=JSON.parse("["+i+"]")}catch(n){r=i?i.split(","):[]}return r.map(e=>bt(t,e))}return e},kt=e=>"string"==typeof e?e.replace(" ","T"):e,St=e=>{let t=e;return t=t.replace(/^ws/i,"http"),t=t.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),t.replace(/\/+$/,"")+"/api/broadcast"};class Nt{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null===(s=this.receivedResp)||void 0===s?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref),this.channel._on(this.refEvent,{},e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Tt,Et,Pt,Ct,Ot,At,It,Rt;(Et=Tt||(Tt={})).SYNC="sync",Et.JOIN="join",Et.LEAVE="leave";class $t{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=$t.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=$t.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{const{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=$t.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){const n=this.cloneDeep(e),i=this.transformState(t),o={},a={};return this.map(n,(e,t)=>{i[e]||(a[e]=t)}),this.map(i,(e,t)=>{const s=n[e];if(s){const r=t.map(e=>e.presence_ref),n=s.map(e=>e.presence_ref),i=t.filter(e=>n.indexOf(e.presence_ref)<0),l=s.filter(e=>r.indexOf(e.presence_ref)<0);i.length>0&&(o[e]=i),l.length>0&&(a[e]=l)}else o[e]=t}),this.syncDiff(n,{joins:o,leaves:a},s,r)}static syncDiff(e,t,s,r){const{joins:n,leaves:i}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(n,(t,r)=>{var n;const i=null!==(n=e[t])&&void 0!==n?n:[];if(e[t]=this.cloneDeep(r),i.length>0){const s=e[t].map(e=>e.presence_ref),r=i.filter(e=>s.indexOf(e.presence_ref)<0);e[t].unshift(...r)}s(t,i,r)}),this.map(i,(t,s)=>{let n=e[t];if(!n)return;const i=s.map(e=>e.presence_ref);n=n.filter(e=>i.indexOf(e.presence_ref)<0),e[t]=n,r(t,n,s),0===n.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const r=e[s];return t[s]="metas"in r?r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(Ct=Pt||(Pt={})).ALL="*",Ct.INSERT="INSERT",Ct.UPDATE="UPDATE",Ct.DELETE="DELETE",(At=Ot||(Ot={})).BROADCAST="broadcast",At.PRESENCE="presence",At.POSTGRES_CHANGES="postgres_changes",At.SYSTEM="system",(Rt=It||(It={})).SUBSCRIBED="SUBSCRIBED",Rt.TIMED_OUT="TIMED_OUT",Rt.CLOSED="CLOSED",Rt.CHANNEL_ERROR="CHANNEL_ERROR";class Ut{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=it.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Nt(this,at.join,this.params,this.timeout),this.rejoinTimer=new ft(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=it.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=it.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=it.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=it.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=it.errored,this.rejoinTimer.scheduleTimeout())}),this._on(at.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new $t(this),this.broadcastEndpointURL=St(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.state==it.closed){const{config:{broadcast:n,presence:i,private:o}}=this.params,a=null!==(r=null===(s=this.bindings.postgres_changes)||void 0===s?void 0:s.map(e=>e.filter))&&void 0!==r?r:[],l=!!this.bindings[Ot.PRESENCE]&&this.bindings[Ot.PRESENCE].length>0,c={},d={broadcast:n,presence:Object.assign(Object.assign({},i),{enabled:l}),postgres_changes:a,private:o};this.socket.accessTokenValue&&(c.access_token=this.socket.accessTokenValue),this._onError(t=>null==e?void 0:e(It.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e(It.CLOSED)),this.updateJoinPayload(Object.assign({config:d},c)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",t=>u(this,[t],function*({postgres_changes:t}){var s;if(this.socket.setAuth(),void 0!==t){const r=this.bindings.postgres_changes,n=null!==(s=null==r?void 0:r.length)&&void 0!==s?s:0,i=[];for(let s=0;s<n;s++){const n=r[s],{filter:{event:o,schema:a,table:l,filter:c}}=n,u=t&&t[s];if(!u||u.event!==o||u.schema!==a||u.table!==l||u.filter!==c)return this.unsubscribe(),this.state=it.errored,void(null==e||e(It.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes")));i.push(Object.assign(Object.assign({},n),{id:u.id}))}return this.bindings.postgres_changes=i,void(e&&e(It.SUBSCRIBED))}null==e||e(It.SUBSCRIBED)})).receive("error",t=>{this.state=it.errored,null==e||e(It.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e(It.TIMED_OUT)})}return this}presenceState(){return this.presence.state}track(e){return u(this,arguments,function*(e,t={}){return yield this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)})}untrack(){return u(this,arguments,function*(e={}){return yield this.send({type:"presence",event:"untrack"},e)})}on(e,t,s){return this.state===it.joined&&e===Ot.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,s)}send(e){return u(this,arguments,function*(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,n,i;const o=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null===(i=null===(n=null===(r=this.params)||void 0===r?void 0:r.config)||void 0===n?void 0:n.broadcast)||void 0===i?void 0:i.ack)||s("ok"),o.receive("ok",()=>s("ok")),o.receive("error",()=>s("error")),o.receive("timeout",()=>s("timed out"))});{const{event:i,payload:o}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const e=yield this._fetchWithTimeout(this.broadcastEndpointURL,a,null!==(s=t.timeout)&&void 0!==s?s:this.timeout);return yield null===(r=e.body)||void 0===r?void 0:r.cancel(),e.ok?"ok":"error"}catch(n){return"AbortError"===n.name?"timed out":"error"}}})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=it.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(at.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(r=>{s=new Nt(this,at.leave,{},e),s.receive("ok",()=>{t(),r("ok")}).receive("timeout",()=>{t(),r("timed out")}).receive("error",()=>{r("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{null==s||s.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=it.closed,this.bindings={}}_fetchWithTimeout(e,t,s){return u(this,null,function*(){const r=new AbortController,n=setTimeout(()=>r.abort(),s),i=yield this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(n),i})}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new Nt(this,e,t,s);return this._canPush()?r.send():this._addToPushBuffer(r),r}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>100){const e=this.pushBuffer.shift();e&&(e.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${e.event}`,e.payload))}}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,n;const i=e.toLocaleLowerCase(),{close:o,error:a,leave:l,join:c}=at;if(s&&[o,a,l,c].indexOf(i)>=0&&s!==this._joinRef())return;let u=this._onMessage(i,t,s);if(t&&!u)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?null===(r=this.bindings.postgres_changes)||void 0===r||r.filter(e=>{var t,s,r;return"*"===(null===(t=e.filter)||void 0===t?void 0:t.event)||(null===(r=null===(s=e.filter)||void 0===s?void 0:s.event)||void 0===r?void 0:r.toLocaleLowerCase())===i}).map(e=>e.callback(u,s)):null===(n=this.bindings[i])||void 0===n||n.filter(e=>{var s,r,n,o,a,l;if(["broadcast","presence","postgres_changes"].includes(i)){if("id"in e){const i=e.id,o=null===(s=e.filter)||void 0===s?void 0:s.event;return i&&(null===(r=t.ids)||void 0===r?void 0:r.includes(i))&&("*"===o||(null==o?void 0:o.toLocaleLowerCase())===(null===(n=t.data)||void 0===n?void 0:n.type.toLocaleLowerCase()))}{const s=null===(a=null===(o=null==e?void 0:e.filter)||void 0===o?void 0:o.event)||void 0===a?void 0:a.toLocaleLowerCase();return"*"===s||s===(null===(l=null==t?void 0:t.event)||void 0===l?void 0:l.toLocaleLowerCase())}}return e.type.toLocaleLowerCase()===i}).map(e=>{if("object"==typeof u&&"ids"in u){const e=u.data,{schema:t,table:s,commit_timestamp:r,type:n,errors:i}=e,o={schema:t,table:s,commit_timestamp:r,eventType:n,new:{},old:{},errors:i};u=Object.assign(Object.assign({},o),this._getPayloadRecords(e))}e.callback(u,s)})}_isClosed(){return this.state===it.closed}_isJoined(){return this.state===it.joined}_isJoining(){return this.state===it.joining}_isLeaving(){return this.state===it.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const r=e.toLocaleLowerCase(),n={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(n):this.bindings[r]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]&&(this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null===(r=e.type)||void 0===r?void 0:r.toLocaleLowerCase())===s&&Ut.isEqual(e.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(at.close,{},e)}_onError(e){this._on(at.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=it.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return"INSERT"!==e.type&&"UPDATE"!==e.type||(t.new=gt(e.columns,e.record)),"UPDATE"!==e.type&&"DELETE"!==e.type||(t.old=gt(e.columns,e.old_record)),t}}const Lt=()=>{},Dt=25e3,qt=10,Mt=100,zt=[1e3,2e3,5e3,1e4];class Bt{constructor(e,t){var s;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=st,this.transport=null,this.heartbeatIntervalMs=Dt,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Lt,this.ref=0,this.reconnectTimer=null,this.logger=Lt,this.conn=null,this.sendBuffer=[],this.serializer=new mt,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=e=>{let t;return t=e||("undefined"==typeof fetch?(...e)=>X(()=>u(this,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ye);return{default:e}}),void 0).then(({default:t})=>t(...e)).catch(e=>{throw new Error(`Failed to load @supabase/node-fetch: ${e.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):fetch),(...e)=>t(...e)},!(null===(s=null==t?void 0:t.params)||void 0===s?void 0:s.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ct.websocket}`,this.httpEndpoint=St(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(null==t?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||null!==this.conn&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=tt.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;if(t.includes("Node.js"))throw new Error(`${t}\n\nTo use Realtime in Node.js, you need to provide a WebSocket implementation:\n\nOption 1: Use Node.js 22+ which has native WebSocket support\nOption 2: Install and provide the "ws" package:\n\n  npm install ws\n\n  import ws from "ws"\n  const client = new RealtimeClient(url, {\n    ...options,\n    transport: ws\n  })`);throw new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const s=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(s),this._setConnectionState("disconnected")},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}removeChannel(e){return u(this,null,function*(){const t=yield e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t})}removeAllChannels(){return u(this,null,function*(){const e=yield Promise.all(this.channels.map(e=>e.unsubscribe()));return this.channels=[],this.disconnect(),e})}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case rt.connecting:return ut.Connecting;case rt.open:return ut.Open;case rt.closing:return ut.Closing;default:return ut.Closed}}isConnected(){return this.connectionState()===ut.Open}isConnecting(){return"connecting"===this._connectionState}isDisconnecting(){return"disconnecting"===this._connectionState}channel(e,t={config:{}}){const s=`realtime:${e}`,r=this.getChannels().find(e=>e.topic===s);if(r)return r;{const s=new Ut(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:s,payload:r,ref:n}=e,i=()=>{this.encode(e,e=>{var t;null===(t=this.conn)||void 0===t||t.send(e)})};this.log("push",`${t} ${s} (${n})`,r),this.isConnected()?i():this.sendBuffer.push(i)}setAuth(e=null){return u(this,null,function*(){this._authPromise=this._performAuth(e);try{yield this._authPromise}finally{this._authPromise=null}})}sendHeartbeat(){return u(this,null,function*(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),this._wasManualDisconnect=!1,null===(e=this.conn)||void 0===e||e.close(1e3,"heartbeat timeout"),void setTimeout(()=>{var e;this.isConnected()||null===(e=this.reconnectTimer)||void 0===e||e.scheduleTimeout()},Mt);this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),this._setAuthSafely("heartbeat")}else this.heartbeatCallback("disconnected")})}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,e=>{"phoenix"===e.topic&&"phx_reply"===e.event&&this.heartbeatCallback("ok"===e.payload.status?"ok":"error"),e.ref&&e.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:t,event:s,payload:r,ref:n}=e,i=n?`(${n})`:"",o=r.status||"";this.log("receive",`${o} ${t} ${s} ${i}`.trim(),r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,n)),this._triggerStateCallbacks("message",e)})}_clearTimer(e){var t;"heartbeat"===e&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):"reconnect"===e&&(null===(t=this.reconnectTimer)||void 0===t||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||null===(t=this.reconnectTimer)||void 0===t||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(at.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;const s=e.match(/\?/)?"&":"?";return`${e}${s}${new URLSearchParams(t)}`}_workerObjectUrl(e){let t;if(e)t=e;else{const e=new Blob(['\n  addEventListener("message", (e) => {\n    if (e.data.event === "start") {\n      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);\n    }\n  });'],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}_setConnectionState(e,t=!1){this._connectionState=e,"connecting"===e?this._wasManualDisconnect=!1:"disconnecting"===e&&(this._wasManualDisconnect=t)}_performAuth(e=null){return u(this,null,function*(){let t;t=e||(this.accessToken?yield this.accessToken():this.accessTokenValue),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(e=>{const s={access_token:t,version:"realtime-js/2.15.1"};t&&e.updateJoinPayload(s),e.joinedOnce&&e._isJoined()&&e._push(at.access_token,{access_token:t})}))})}_waitForAuthIfNeeded(){return u(this,null,function*(){this._authPromise&&(yield this._authPromise)})}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(s=>{try{s(t)}catch(r){this.log("error",`error in ${e} callback`,r)}})}catch(s){this.log("error",`error triggering ${e} callbacks`,s)}}_setupReconnectionTimer(){this.reconnectTimer=new ft(()=>u(this,null,function*(){setTimeout(()=>u(this,null,function*(){yield this._waitForAuthIfNeeded(),this.isConnected()||this.connect()}),qt)}),this.reconnectAfterMs)}_initializeOptions(e){var t,s,r,n,i,o,a,l;if(this.transport=null!==(t=null==e?void 0:e.transport)&&void 0!==t?t:null,this.timeout=null!==(s=null==e?void 0:e.timeout)&&void 0!==s?s:st,this.heartbeatIntervalMs=null!==(r=null==e?void 0:e.heartbeatIntervalMs)&&void 0!==r?r:Dt,this.worker=null!==(n=null==e?void 0:e.worker)&&void 0!==n&&n,this.accessToken=null!==(i=null==e?void 0:e.accessToken)&&void 0!==i?i:null,(null==e?void 0:e.params)&&(this.params=e.params),(null==e?void 0:e.logger)&&(this.logger=e.logger),((null==e?void 0:e.logLevel)||(null==e?void 0:e.log_level))&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=null!==(o=null==e?void 0:e.reconnectAfterMs)&&void 0!==o?o:e=>zt[e-1]||1e4,this.encode=null!==(a=null==e?void 0:e.encode)&&void 0!==a?a:(e,t)=>t(JSON.stringify(e)),this.decode=null!==(l=null==e?void 0:e.decode)&&void 0!==l?l:this.serializer.decode.bind(this.serializer),this.worker){if("undefined"!=typeof window&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=null==e?void 0:e.workerUrl}}}class Ft extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function Jt(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class Wt extends Ft{constructor(e,t,s){super(e),this.name="StorageApiError",this.status=t,this.statusCode=s}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class Kt extends Ft{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Vt=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const Gt=t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>X(()=>u(e,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ye);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},Ht=e=>{if(Array.isArray(e))return e.map(e=>Ht(e));if("function"==typeof e||e!==Object(e))return e;const t={};return Object.entries(e).forEach(([e,s])=>{const r=e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""));t[r]=Ht(s)}),t};var Yt=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const Zt=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),Xt=(e,t,s)=>Yt(void 0,void 0,void 0,function*(){const r=yield Vt(void 0,void 0,void 0,function*(){return"undefined"==typeof Response?(yield X(()=>Promise.resolve().then(()=>ye),void 0)).Response:Response});e instanceof r&&!(null==s?void 0:s.noResolveJson)?e.json().then(s=>{const r=e.status||500,n=(null==s?void 0:s.statusCode)||r+"";t(new Wt(Zt(s),r,n))}).catch(e=>{t(new Kt(Zt(e),e))}):t(new Kt(Zt(e),e))}),Qt=(e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"!==e&&r?((e=>{if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)})(r)?(n.headers=Object.assign({"Content-Type":"application/json"},null==t?void 0:t.headers),n.body=JSON.stringify(r)):n.body=r,(null==t?void 0:t.duplex)&&(n.duplex=t.duplex),Object.assign(Object.assign({},n),s)):n};function es(e,t,s,r,n,i){return Yt(this,void 0,void 0,function*(){return new Promise((o,a)=>{e(s,Qt(t,r,n,i)).then(e=>{if(!e.ok)throw e;return(null==r?void 0:r.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(e=>Xt(e,a,r))})})}function ts(e,t,s,r){return Yt(this,void 0,void 0,function*(){return es(e,"GET",t,s,r)})}function ss(e,t,s,r,n){return Yt(this,void 0,void 0,function*(){return es(e,"POST",t,r,n,s)})}function rs(e,t,s,r,n){return Yt(this,void 0,void 0,function*(){return es(e,"PUT",t,r,n,s)})}function ns(e,t,s,r,n){return Yt(this,void 0,void 0,function*(){return es(e,"DELETE",t,r,n,s)})}var is=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const os={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},as={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class ls{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=Gt(r)}uploadOrUpdate(e,t,s,r){return is(this,void 0,void 0,function*(){try{let n;const i=Object.assign(Object.assign({},as),r);let o=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(i.upsert)});const a=i.metadata;"undefined"!=typeof Blob&&s instanceof Blob?(n=new FormData,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a)),n.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(n=s,n.append("cacheControl",i.cacheControl),a&&n.append("metadata",this.encodeMetadata(a))):(n=s,o["cache-control"]=`max-age=${i.cacheControl}`,o["content-type"]=i.contentType,a&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(a)))),(null==r?void 0:r.headers)&&(o=Object.assign(Object.assign({},o),r.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield("PUT"==e?rs:ss)(this.fetch,`${this.url}/object/${c}`,n,Object.assign({headers:o},(null==i?void 0:i.duplex)?{duplex:i.duplex}:{}));return{data:{path:l,id:u.Id,fullPath:u.Key},error:null}}catch(n){if(Jt(n))return{data:null,error:n};throw n}})}upload(e,t,s){return is(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return is(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),i=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${i}`);o.searchParams.set("token",t);try{let e;const t=Object.assign({upsert:as.upsert},r),i=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});return"undefined"!=typeof Blob&&s instanceof Blob?(e=new FormData,e.append("cacheControl",t.cacheControl),e.append("",s)):"undefined"!=typeof FormData&&s instanceof FormData?(e=s,e.append("cacheControl",t.cacheControl)):(e=s,i["cache-control"]=`max-age=${t.cacheControl}`,i["content-type"]=t.contentType),{data:{path:n,fullPath:(yield rs(this.fetch,o.toString(),e,{headers:i})).Key},error:null}}catch(a){if(Jt(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(e,t){return is(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");const n=yield ss(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),i=new URL(this.url+n.url),o=i.searchParams.get("token");if(!o)throw new Ft("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:o},error:null}}catch(s){if(Jt(s))return{data:null,error:s};throw s}})}update(e,t,s){return is(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return is(this,void 0,void 0,function*(){try{return{data:yield ss(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(r){if(Jt(r))return{data:null,error:r};throw r}})}copy(e,t,s){return is(this,void 0,void 0,function*(){try{return{data:{path:(yield ss(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(r){if(Jt(r))return{data:null,error:r};throw r}})}createSignedUrl(e,t,s){return is(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),n=yield ss(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers});const i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${i}`)},{data:n,error:null}}catch(r){if(Jt(r))return{data:null,error:r};throw r}})}createSignedUrls(e,t,s){return is(this,void 0,void 0,function*(){try{const r=yield ss(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${n}`):null})),error:null}}catch(r){if(Jt(r))return{data:null,error:r};throw r}})}download(e,t){return is(this,void 0,void 0,function*(){const s=void 0!==(null==t?void 0:t.transform)?"render/image/authenticated":"object",r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),n=r?`?${r}`:"";try{const t=this._getFinalPath(e),r=yield ts(this.fetch,`${this.url}/${s}/${t}${n}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(i){if(Jt(i))return{data:null,error:i};throw i}})}info(e){return is(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const e=yield ts(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ht(e),error:null}}catch(s){if(Jt(s))return{data:null,error:s};throw s}})}exists(e){return is(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield function(e,t,s,r){return Yt(this,void 0,void 0,function*(){return es(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),r)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(Jt(s)&&s instanceof Kt){const e=s.originalError;if([400,404].includes(null==e?void 0:e.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),r=[],n=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==n&&r.push(n);const i=void 0!==(null==t?void 0:t.transform)?"render/image":"object",o=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==o&&r.push(o);let a=r.join("&");return""!==a&&(a=`?${a}`),{data:{publicUrl:encodeURI(`${this.url}/${i}/public/${s}${a}`)}}}remove(e){return is(this,void 0,void 0,function*(){try{return{data:yield ns(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(Jt(t))return{data:null,error:t};throw t}})}list(e,t,s){return is(this,void 0,void 0,function*(){try{const r=Object.assign(Object.assign(Object.assign({},os),t),{prefix:e||""});return{data:yield ss(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(r){if(Jt(r))return{data:null,error:r};throw r}})}listV2(e,t){return is(this,void 0,void 0,function*(){try{const s=Object.assign({},e);return{data:yield ss(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,s,{headers:this.headers},t),error:null}}catch(s){if(Jt(s))return{data:null,error:s};throw s}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return"undefined"!=typeof Buffer?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const cs={"X-Client-Info":"storage-js/2.11.0"};var us=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};class ds{constructor(e,t={},s,r){const n=new URL(e);(null==r?void 0:r.useNewHostname)&&/supabase\.(co|in|red)$/.test(n.hostname)&&!n.hostname.includes("storage.supabase.")&&(n.hostname=n.hostname.replace("supabase.","storage.supabase.")),this.url=n.href,this.headers=Object.assign(Object.assign({},cs),t),this.fetch=Gt(s)}listBuckets(){return us(this,void 0,void 0,function*(){try{return{data:yield ts(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(Jt(e))return{data:null,error:e};throw e}})}getBucket(e){return us(this,void 0,void 0,function*(){try{return{data:yield ts(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(Jt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return us(this,void 0,void 0,function*(){try{return{data:yield ss(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Jt(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return us(this,void 0,void 0,function*(){try{return{data:yield rs(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(Jt(s))return{data:null,error:s};throw s}})}emptyBucket(e){return us(this,void 0,void 0,function*(){try{return{data:yield ss(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(Jt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return us(this,void 0,void 0,function*(){try{return{data:yield ns(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(Jt(t))return{data:null,error:t};throw t}})}}class hs extends ds{constructor(e,t={},s,r){super(e,t,s,r)}from(e){return new ls(this.url,this.headers,e,this.fetch)}}let ps="";ps="undefined"!=typeof Deno?"deno":"undefined"!=typeof document?"web":"undefined"!=typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";const ms={headers:{"X-Client-Info":`supabase-js-${ps}/2.55.0`}},fs={schema:"public"},gs={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},vs={};var bs=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const ys=(e,t,s)=>{const r=(e=>{let t;return t=e||("undefined"==typeof fetch?fe:fetch),(...e)=>t(...e)})(s),n="undefined"==typeof Headers?ge:Headers;return(s,i)=>bs(void 0,void 0,void 0,function*(){var o;const a=null!==(o=yield t())&&void 0!==o?o:e;let l=new n(null==i?void 0:i.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${a}`),r(s,Object.assign(Object.assign({},i),{headers:l}))})};var xs=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};const ws="2.71.1",_s=3e4,js=9e4,ks={"X-Client-Info":`gotrue-js/${ws}`},Ss="X-Supabase-Api-Version",Ns={timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"},Ts=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i;class Es extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function Ps(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class Cs extends Es{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class Os extends Es{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class As extends Es{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class Is extends As{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class Rs extends As{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class $s extends As{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Us extends As{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ls extends As{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Ds extends As{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function qs(e){return Ps(e)&&"AuthRetryableFetchError"===e.name}class Ms extends As{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class zs extends As{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Bs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Fs=" \t\n\r=".split(""),Js=(()=>{const e=new Array(128);for(let t=0;t<e.length;t+=1)e[t]=-1;for(let t=0;t<Fs.length;t+=1)e[Fs[t].charCodeAt(0)]=-2;for(let t=0;t<Bs.length;t+=1)e[Bs[t].charCodeAt(0)]=t;return e})();function Ws(e,t,s){if(null!==e)for(t.queue=t.queue<<8|e,t.queuedBits+=8;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Bs[e]),t.queuedBits-=6}else if(t.queuedBits>0)for(t.queue=t.queue<<6-t.queuedBits,t.queuedBits=6;t.queuedBits>=6;){const e=t.queue>>t.queuedBits-6&63;s(Bs[e]),t.queuedBits-=6}}function Ks(e,t,s){const r=Js[e];if(!(r>-1)){if(-2===r)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(e)}"`)}for(t.queue=t.queue<<6|r,t.queuedBits+=6;t.queuedBits>=8;)s(t.queue>>t.queuedBits-8&255),t.queuedBits-=8}function Vs(e){const t=[],s=e=>{t.push(String.fromCodePoint(e))},r={utf8seq:0,codepoint:0},n={queue:0,queuedBits:0},i=e=>{!function(e,t,s){if(0===t.utf8seq){if(e<=127)return void s(e);for(let s=1;s<6;s+=1)if(!(e>>7-s&1)){t.utf8seq=s;break}if(2===t.utf8seq)t.codepoint=31&e;else if(3===t.utf8seq)t.codepoint=15&e;else{if(4!==t.utf8seq)throw new Error("Invalid UTF-8 sequence");t.codepoint=7&e}t.utf8seq-=1}else if(t.utf8seq>0){if(e<=127)throw new Error("Invalid UTF-8 sequence");t.codepoint=t.codepoint<<6|63&e,t.utf8seq-=1,0===t.utf8seq&&s(t.codepoint)}}(e,r,s)};for(let o=0;o<e.length;o+=1)Ks(e.charCodeAt(o),n,i);return t.join("")}function Gs(e,t){if(!(e<=127)){if(e<=2047)return t(192|e>>6),void t(128|63&e);if(e<=65535)return t(224|e>>12),t(128|e>>6&63),void t(128|63&e);if(e<=1114111)return t(240|e>>18),t(128|e>>12&63),t(128|e>>6&63),void t(128|63&e);throw new Error(`Unrecognized Unicode codepoint: ${e.toString(16)}`)}t(e)}function Hs(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};for(let n=0;n<e.length;n+=1)Ks(e.charCodeAt(n),s,r);return new Uint8Array(t)}function Ys(e){const t=[];return function(e,t){for(let s=0;s<e.length;s+=1){let r=e.charCodeAt(s);if(r>55295&&r<=56319){const t=1024*(r-55296)&65535;r=65536+(e.charCodeAt(s+1)-56320&65535|t),s+=1}Gs(r,t)}}(e,e=>t.push(e)),new Uint8Array(t)}function Zs(e){const t=[],s={queue:0,queuedBits:0},r=e=>{t.push(e)};return e.forEach(e=>Ws(e,s,r)),Ws(null,s,r),t.join("")}const Xs=()=>"undefined"!=typeof window&&"undefined"!=typeof document,Qs={tested:!1,writable:!1},er=()=>{if(!Xs())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(t){return!1}if(Qs.tested)return Qs.writable;const e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),Qs.tested=!0,Qs.writable=!0}catch(t){Qs.tested=!0,Qs.writable=!1}return Qs.writable},tr=t=>{let s;return s=t||("undefined"==typeof fetch?(...t)=>X(()=>u(e,null,function*(){const{default:e}=yield Promise.resolve().then(()=>ye);return{default:e}}),void 0).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},sr=(t,s,r)=>u(e,null,function*(){yield t.setItem(s,JSON.stringify(r))}),rr=(t,s)=>u(e,null,function*(){const e=yield t.getItem(s);if(!e)return null;try{return JSON.parse(e)}catch(r){return e}}),nr=(t,s)=>u(e,null,function*(){yield t.removeItem(s)});class ir{constructor(){this.promise=new ir.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function or(e){const t=e.split(".");if(3!==t.length)throw new zs("Invalid JWT structure");for(let s=0;s<t.length;s++)if(!Ts.test(t[s]))throw new zs("JWT not in base64url format");return{header:JSON.parse(Vs(t[0])),payload:JSON.parse(Vs(t[1])),signature:Hs(t[2]),raw:{header:t[0],payload:t[1]}}}function ar(e){return("0"+e.toString(16)).substr(-2)}function lr(e){return u(this,null,function*(){if("undefined"==typeof crypto||void 0===crypto.subtle||"undefined"==typeof TextEncoder)return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e;const t=yield function(e){return u(this,null,function*(){const t=(new TextEncoder).encode(e),s=yield crypto.subtle.digest("SHA-256",t),r=new Uint8Array(s);return Array.from(r).map(e=>String.fromCharCode(e)).join("")})}(e);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})}function cr(e,t,s=!1){return u(this,null,function*(){const r=function(){const e=new Uint32Array(56);if("undefined"==typeof crypto){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length;let s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,ar).join("")}();let n=r;s&&(n+="/PASSWORD_RECOVERY"),yield sr(e,`${t}-code-verifier`,n);const i=yield lr(r);return[i,r===i?"plain":"s256"]})}ir.promiseConstructor=Promise;const ur=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i,dr=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function hr(e){if(!dr.test(e))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function pr(){return new Proxy({},{get:(e,t)=>{if("__isUserNotAvailableProxy"===t)return!0;if("symbol"==typeof t){const e=t.toString();if("Symbol(Symbol.toPrimitive)"===e||"Symbol(Symbol.toStringTag)"===e||"Symbol(util.inspect.custom)"===e)return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function mr(e){return JSON.parse(JSON.stringify(e))}const fr=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),gr=[502,503,504];function vr(e){return u(this,null,function*(){var t,s;if(!("object"==typeof(s=e)&&null!==s&&"status"in s&&"ok"in s&&"json"in s&&"function"==typeof s.json))throw new Ds(fr(e),0);if(gr.includes(e.status))throw new Ds(fr(e),e.status);let r,n;try{r=yield e.json()}catch(o){throw new Os(fr(o),o)}const i=function(e){const t=e.headers.get(Ss);if(!t)return null;if(!t.match(ur))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(o){return null}}(e);if(i&&i.getTime()>=Ns.timestamp&&"object"==typeof r&&r&&"string"==typeof r.code?n=r.code:"object"==typeof r&&r&&"string"==typeof r.error_code&&(n=r.error_code),n){if("weak_password"===n)throw new Ms(fr(r),e.status,(null===(t=r.weak_password)||void 0===t?void 0:t.reasons)||[]);if("session_not_found"===n)throw new Is}else if("object"==typeof r&&r&&"object"==typeof r.weak_password&&r.weak_password&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new Ms(fr(r),e.status,r.weak_password.reasons);throw new Cs(fr(r),e.status||500,n)})}function br(e,t,s,r){return u(this,null,function*(){var n;const i=Object.assign({},null==r?void 0:r.headers);i[Ss]||(i[Ss]=Ns.name),(null==r?void 0:r.jwt)&&(i.Authorization=`Bearer ${r.jwt}`);const o=null!==(n=null==r?void 0:r.query)&&void 0!==n?n:{};(null==r?void 0:r.redirectTo)&&(o.redirect_to=r.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",l=yield function(e,t,s,r,n,i){return u(this,null,function*(){const o=((e,t,s,r)=>{const n={method:e,headers:(null==t?void 0:t.headers)||{}};return"GET"===e?n:(n.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==t?void 0:t.headers),n.body=JSON.stringify(r),Object.assign(Object.assign({},n),s))})(t,r,n,i);let a;try{a=yield e(s,Object.assign({},o))}catch(l){throw console.error(l),new Ds(fr(l),0)}if(a.ok||(yield vr(a)),null==r?void 0:r.noResolveJson)return a;try{return yield a.json()}catch(l){yield vr(l)}})}(e,t,s+a,{headers:i,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}})}function yr(e){var t;let s=null;var r;return function(e){return e.access_token&&e.refresh_token&&e.expires_in}(e)&&(s=Object.assign({},e),e.expires_at||(s.expires_at=(r=e.expires_in,Math.round(Date.now()/1e3)+r))),{data:{session:s,user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function xr(e){const t=yr(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function wr(e){var t;return{data:{user:null!==(t=e.user)&&void 0!==t?t:e},error:null}}function _r(e){return{data:e,error:null}}function jr(e){const{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i}=e,o=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]])}return s}(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]);return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:n,verification_type:i},user:Object.assign({},o)},error:null}}function kr(e){return e}const Sr=["global","local","others"];class Nr{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=tr(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}signOut(e){return u(this,arguments,function*(e,t=Sr[0]){if(Sr.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Sr.join(", ")}`);try{return yield br(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(Ps(s))return{data:null,error:s};throw s}})}inviteUserByEmail(e){return u(this,arguments,function*(e,t={}){try{return yield br(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:wr})}catch(s){if(Ps(s))return{data:{user:null},error:s};throw s}})}generateLink(e){return u(this,null,function*(){try{const{options:t}=e,s=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(s[r[n]]=e[r[n]])}return s}(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),yield br(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:jr,redirectTo:null==t?void 0:t.redirectTo})}catch(t){if(Ps(t))return{data:{properties:null,user:null},error:t};throw t}})}createUser(e){return u(this,null,function*(){try{return yield br(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:wr})}catch(t){if(Ps(t))return{data:{user:null},error:t};throw t}})}listUsers(e){return u(this,null,function*(){var t,s,r,n,i,o,a;try{const l={nextPage:null,lastPage:0,total:0},c=yield br(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!==(s=null===(t=null==e?void 0:e.page)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",per_page:null!==(n=null===(r=null==e?void 0:e.perPage)||void 0===r?void 0:r.toString())&&void 0!==n?n:""},xform:kr});if(c.error)throw c.error;const u=yield c.json(),d=null!==(i=c.headers.get("x-total-count"))&&void 0!==i?i:0,h=null!==(a=null===(o=c.headers.get("link"))||void 0===o?void 0:o.split(","))&&void 0!==a?a:[];return h.length>0&&(h.forEach(e=>{const t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(d)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(Ps(l))return{data:{users:[]},error:l};throw l}})}getUserById(e){return u(this,null,function*(){hr(e);try{return yield br(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:wr})}catch(t){if(Ps(t))return{data:{user:null},error:t};throw t}})}updateUserById(e,t){return u(this,null,function*(){hr(e);try{return yield br(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:wr})}catch(s){if(Ps(s))return{data:{user:null},error:s};throw s}})}deleteUser(e,t=!1){return u(this,null,function*(){hr(e);try{return yield br(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:wr})}catch(s){if(Ps(s))return{data:{user:null},error:s};throw s}})}_listFactors(e){return u(this,null,function*(){hr(e.userId);try{const{data:t,error:s}=yield br(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(t){if(Ps(t))return{data:null,error:t};throw t}})}_deleteFactor(e){return u(this,null,function*(){hr(e.userId),hr(e.id);try{return{data:yield br(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Ps(t))return{data:null,error:t};throw t}})}}function Tr(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}const Er=!!(globalThis&&er()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"));class Pr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Cr extends Pr{}function Or(e,t,s){return u(this,null,function*(){Er&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);const r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),Er&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),yield Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},r=>u(this,null,function*(){if(!r){if(0===t)throw Er&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new Cr(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(Er)try{const e=yield globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),yield s()}Er&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return yield s()}finally{Er&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}})))})}!function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}();const Ar={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:ks,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};function Ir(e,t,s){return u(this,null,function*(){return yield s()})}const Rr={};class $r{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=$r.nextInstanceID,$r.nextInstanceID+=1,this.instanceID>0&&Xs()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},Ar),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new Nr({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=tr(r.fetch),this.lock=r.lock||Ir,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:Xs()&&(null===(t=null===globalThis||void 0===globalThis?void 0:globalThis.navigator)||void 0===t?void 0:t.locks)?this.lock=Or:this.lock=Ir,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(r.storage?this.storage=r.storage:er()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Tr(this.memoryStorage)),r.userStorage&&(this.userStorage=r.userStorage)):(this.memoryStorage={},this.storage=Tr(this.memoryStorage)),Xs()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}null===(s=this.broadcastChannel)||void 0===s||s.addEventListener("message",e=>u(this,null,function*(){this._debug("received broadcast notification from other tab or client",e),yield this._notifyAllSubscribers(e.data.event,e.data.session,!1)}))}this.initialize()}get jwks(){var e,t;return null!==(t=null===(e=Rr[this.storageKey])||void 0===e?void 0:e.jwks)&&void 0!==t?t:{keys:[]}}set jwks(e){Rr[this.storageKey]=Object.assign(Object.assign({},Rr[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return null!==(t=null===(e=Rr[this.storageKey])||void 0===e?void 0:e.cachedAt)&&void 0!==t?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Rr[this.storageKey]=Object.assign(Object.assign({},Rr[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ws}) ${(new Date).toISOString()}`,...e),this}initialize(){return u(this,null,function*(){return this.initializePromise||(this.initializePromise=(()=>u(this,null,function*(){return yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._initialize()}))}))()),yield this.initializePromise})}_initialize(){return u(this,null,function*(){var e;try{const t=function(e){const t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(r){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":(yield this._isPKCECallback(t))&&(s="pkce"),Xs()&&this.detectSessionInUrl&&"none"!==s){const{data:r,error:n}=yield this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),function(e){return Ps(e)&&"AuthImplicitGrantRedirectError"===e.name}(n)){const t=null===(e=n.details)||void 0===e?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:n}}return yield this._removeSession(),{error:n}}const{session:i,redirectType:o}=r;return this._debug("#_initialize()","detected session in URL",i,"redirect type",o),yield this._saveSession(i),setTimeout(()=>u(this,null,function*(){"recovery"===o?yield this._notifyAllSubscribers("PASSWORD_RECOVERY",i):yield this._notifyAllSubscribers("SIGNED_IN",i)}),0),{error:null}}return yield this._recoverAndRefresh(),{error:null}}catch(t){return Ps(t)?{error:t}:{error:new Os("Unexpected error during initialization",t)}}finally{yield this._handleVisibilityChange(),this._debug("#_initialize()","end")}})}signInAnonymously(e){return u(this,null,function*(){var t,s,r;try{const n=yield br(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!==(s=null===(t=null==e?void 0:e.options)||void 0===t?void 0:t.data)&&void 0!==s?s:{},gotrue_meta_security:{captcha_token:null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken}},xform:yr}),{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(Ps(n))return{data:{user:null,session:null},error:n};throw n}})}signUp(e){return u(this,null,function*(){var t,s,r;try{let n;if("email"in e){const{email:s,password:r,options:i}=e;let o=null,a=null;"pkce"===this.flowType&&([o,a]=yield cr(this.storage,this.storageKey)),n=yield br(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==i?void 0:i.emailRedirectTo,body:{email:s,password:r,data:null!==(t=null==i?void 0:i.data)&&void 0!==t?t:{},gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:o,code_challenge_method:a},xform:yr})}else{if(!("phone"in e))throw new $s("You must provide either an email or phone number and a password");{const{phone:t,password:i,options:o}=e;n=yield br(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:i,data:null!==(s=null==o?void 0:o.data)&&void 0!==s?s:{},channel:null!==(r=null==o?void 0:o.channel)&&void 0!==r?r:"sms",gotrue_meta_security:{captcha_token:null==o?void 0:o.captchaToken}},xform:yr})}}const{data:i,error:o}=n;if(o||!i)return{data:{user:null,session:null},error:o};const a=i.session,l=i.user;return i.session&&(yield this._saveSession(i.session),yield this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(n){if(Ps(n))return{data:{user:null,session:null},error:n};throw n}})}signInWithPassword(e){return u(this,null,function*(){try{let t;if("email"in e){const{email:s,password:r,options:n}=e;t=yield br(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:xr})}else{if(!("phone"in e))throw new $s("You must provide either an email or phone number and a password");{const{phone:s,password:r,options:n}=e;t=yield br(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},xform:xr})}}const{data:s,error:r}=t;return r?{data:{user:null,session:null},error:r}:s&&s.session&&s.user?(s.session&&(yield this._saveSession(s.session),yield this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}):{data:{user:null,session:null},error:new Rs}}catch(t){if(Ps(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOAuth(e){return u(this,null,function*(){var t,s,r,n;return yield this._handleProviderSignIn(e.provider,{redirectTo:null===(t=e.options)||void 0===t?void 0:t.redirectTo,scopes:null===(s=e.options)||void 0===s?void 0:s.scopes,queryParams:null===(r=e.options)||void 0===r?void 0:r.queryParams,skipBrowserRedirect:null===(n=e.options)||void 0===n?void 0:n.skipBrowserRedirect})})}exchangeCodeForSession(e){return u(this,null,function*(){return yield this.initializePromise,this._acquireLock(-1,()=>u(this,null,function*(){return this._exchangeCodeForSession(e)}))})}signInWithWeb3(e){return u(this,null,function*(){const{chain:t}=e;if("solana"===t)return yield this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)})}signInWithSolana(e){return u(this,null,function*(){var t,s,r,n,i,o,a,l,c,u,d,h;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:d,wallet:h,statement:f,options:g}=e;let v;if(Xs())if("object"==typeof h)v=h;else{const e=window;if(!("solana"in e)||"object"!=typeof e.solana||!("signIn"in e.solana&&"function"==typeof e.solana.signIn||"signMessage"in e.solana&&"function"==typeof e.solana.signMessage))throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.");v=e.solana}else{if("object"!=typeof h||!(null==g?void 0:g.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");v=h}const b=new URL(null!==(t=null==g?void 0:g.url)&&void 0!==t?t:window.location.href);if("signIn"in v&&v.signIn){const e=yield v.signIn(Object.assign(Object.assign(Object.assign({issuedAt:(new Date).toISOString()},null==g?void 0:g.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),f?{statement:f}:null));let t;if(Array.isArray(e)&&e[0]&&"object"==typeof e[0])t=e[0];else{if(!(e&&"object"==typeof e&&"signedMessage"in e&&"signature"in e))throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");t=e}if(!("signedMessage"in t&&"signature"in t&&("string"==typeof t.signedMessage||t.signedMessage instanceof Uint8Array)&&t.signature instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields");p="string"==typeof t.signedMessage?t.signedMessage:(new TextDecoder).decode(t.signedMessage),m=t.signature}else{if(!("signMessage"in v&&"function"==typeof v.signMessage&&"publicKey"in v&&"object"==typeof v&&v.publicKey&&"toBase58"in v.publicKey&&"function"==typeof v.publicKey.toBase58))throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${b.host} wants you to sign in with your Solana account:`,v.publicKey.toBase58(),...f?["",f,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${null!==(r=null===(s=null==g?void 0:g.signInWithSolana)||void 0===s?void 0:s.issuedAt)&&void 0!==r?r:(new Date).toISOString()}`,...(null===(n=null==g?void 0:g.signInWithSolana)||void 0===n?void 0:n.notBefore)?[`Not Before: ${g.signInWithSolana.notBefore}`]:[],...(null===(i=null==g?void 0:g.signInWithSolana)||void 0===i?void 0:i.expirationTime)?[`Expiration Time: ${g.signInWithSolana.expirationTime}`]:[],...(null===(o=null==g?void 0:g.signInWithSolana)||void 0===o?void 0:o.chainId)?[`Chain ID: ${g.signInWithSolana.chainId}`]:[],...(null===(a=null==g?void 0:g.signInWithSolana)||void 0===a?void 0:a.nonce)?[`Nonce: ${g.signInWithSolana.nonce}`]:[],...(null===(l=null==g?void 0:g.signInWithSolana)||void 0===l?void 0:l.requestId)?[`Request ID: ${g.signInWithSolana.requestId}`]:[],...(null===(u=null===(c=null==g?void 0:g.signInWithSolana)||void 0===c?void 0:c.resources)||void 0===u?void 0:u.length)?["Resources",...g.signInWithSolana.resources.map(e=>`- ${e}`)]:[]].join("\n");const e=yield v.signMessage((new TextEncoder).encode(p),"utf8");if(!(e&&e instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=e}}try{const{data:t,error:s}=yield br(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:Zs(m)},(null===(d=e.options)||void 0===d?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:null===(h=e.options)||void 0===h?void 0:h.captchaToken}}:null),xform:yr});if(s)throw s;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign({},t),error:s}):{data:{user:null,session:null},error:new Rs}}catch(f){if(Ps(f))return{data:{user:null,session:null},error:f};throw f}})}_exchangeCodeForSession(e){return u(this,null,function*(){const t=yield rr(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{const{data:t,error:n}=yield br(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:yr});if(yield nr(this.storage,`${this.storageKey}-code-verifier`),n)throw n;return t&&t.session&&t.user?(t.session&&(yield this._saveSession(t.session),yield this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:n}):{data:{user:null,session:null,redirectType:null},error:new Rs}}catch(n){if(Ps(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}})}signInWithIdToken(e){return u(this,null,function*(){try{const{options:t,provider:s,token:r,access_token:n,nonce:i}=e,o=yield br(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:n,nonce:i,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:yr}),{data:a,error:l}=o;return l?{data:{user:null,session:null},error:l}:a&&a.session&&a.user?(a.session&&(yield this._saveSession(a.session),yield this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:l}):{data:{user:null,session:null},error:new Rs}}catch(t){if(Ps(t))return{data:{user:null,session:null},error:t};throw t}})}signInWithOtp(e){return u(this,null,function*(){var t,s,r,n,i;try{if("email"in e){const{email:r,options:n}=e;let i=null,o=null;"pkce"===this.flowType&&([i,o]=yield cr(this.storage,this.storageKey));const{error:a}=yield br(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!==(t=null==n?void 0:n.data)&&void 0!==t?t:{},create_user:null===(s=null==n?void 0:n.shouldCreateUser)||void 0===s||s,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:i,code_challenge_method:o},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:a}}if("phone"in e){const{phone:t,options:s}=e,{data:o,error:a}=yield br(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!==(r=null==s?void 0:s.data)&&void 0!==r?r:{},create_user:null===(n=null==s?void 0:s.shouldCreateUser)||void 0===n||n,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!==(i=null==s?void 0:s.channel)&&void 0!==i?i:"sms"}});return{data:{user:null,session:null,messageId:null==o?void 0:o.message_id},error:a}}throw new $s("You must provide either an email or phone number.")}catch(o){if(Ps(o))return{data:{user:null,session:null},error:o};throw o}})}verifyOtp(e){return u(this,null,function*(){var t,s;try{let r,n;"options"in e&&(r=null===(t=e.options)||void 0===t?void 0:t.redirectTo,n=null===(s=e.options)||void 0===s?void 0:s.captchaToken);const{data:i,error:o}=yield br(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:r,xform:yr});if(o)throw o;if(!i)throw new Error("An error occurred on token verification.");const a=i.session,l=i.user;return(null==a?void 0:a.access_token)&&(yield this._saveSession(a),yield this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",a)),{data:{user:l,session:a},error:null}}catch(r){if(Ps(r))return{data:{user:null,session:null},error:r};throw r}})}signInWithSSO(e){return u(this,null,function*(){var t,s,r;try{let n=null,i=null;return"pkce"===this.flowType&&([n,i]=yield cr(this.storage,this.storageKey)),yield br(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!==(s=null===(t=e.options)||void 0===t?void 0:t.redirectTo)&&void 0!==s?s:void 0}),(null===(r=null==e?void 0:e.options)||void 0===r?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:i}),headers:this.headers,xform:_r})}catch(n){if(Ps(n))return{data:null,error:n};throw n}})}reauthenticate(){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._reauthenticate()}))})}_reauthenticate(){return u(this,null,function*(){try{return yield this._useSession(e=>u(this,null,function*(){const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new Is;const{error:r}=yield br(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}}))}catch(e){if(Ps(e))return{data:{user:null,session:null},error:e};throw e}})}resend(e){return u(this,null,function*(){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:r,options:n}=e,{error:i}=yield br(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}},redirectTo:null==n?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:i}}if("phone"in e){const{phone:s,type:r,options:n}=e,{data:i,error:o}=yield br(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:null==i?void 0:i.message_id},error:o}}throw new $s("You must provide either an email or phone number and a type")}catch(t){if(Ps(t))return{data:{user:null,session:null},error:t};throw t}})}getSession(){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return this._useSession(e=>u(this,null,function*(){return e}))}))})}_acquireLock(e,t){return u(this,null,function*(){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(()=>u(this,null,function*(){return yield e,yield t()}))();return this.pendingInLock.push((()=>u(this,null,function*(){try{yield s}catch(e){}}))()),s}return yield this.lock(`lock:${this.storageKey}`,e,()=>u(this,null,function*(){this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const e=t();for(this.pendingInLock.push((()=>u(this,null,function*(){try{yield e}catch(t){}}))()),yield e;this.pendingInLock.length;){const e=[...this.pendingInLock];yield Promise.all(e),this.pendingInLock.splice(0,e.length)}return yield e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}}))}finally{this._debug("#_acquireLock","end")}})}_useSession(e){return u(this,null,function*(){this._debug("#_useSession","begin");try{const t=yield this.__loadSession();return yield e(t)}finally{this._debug("#_useSession","end")}})}__loadSession(){return u(this,null,function*(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",(new Error).stack);try{let e=null;const t=yield rr(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),yield this._removeSession())),!e)return{data:{session:null},error:null};const s=!!e.expires_at&&1e3*e.expires_at-Date.now()<js;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const t=yield rr(this.userStorage,this.storageKey+"-user");(null==t?void 0:t.user)?e.user=t.user:e.user=pr()}if(this.storage.isServer&&e.user){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}const{session:r,error:n}=yield this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}})}getUser(e){return u(this,null,function*(){return e?yield this._getUser(e):(yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._getUser()})))})}_getUser(e){return u(this,null,function*(){try{return e?yield br(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:wr}):yield this._useSession(e=>u(this,null,function*(){var t,s,r;const{data:n,error:i}=e;if(i)throw i;return(null===(t=n.session)||void 0===t?void 0:t.access_token)||this.hasCustomAuthorizationHeader?yield br(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!==(r=null===(s=n.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0,xform:wr}):{data:{user:null},error:new Is}}))}catch(t){if(Ps(t))return function(e){return Ps(e)&&"AuthSessionMissingError"===e.name}(t)&&(yield this._removeSession(),yield nr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}})}updateUser(e){return u(this,arguments,function*(e,t={}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._updateUser(e,t)}))})}_updateUser(e){return u(this,arguments,function*(e,t={}){try{return yield this._useSession(s=>u(this,null,function*(){const{data:r,error:n}=s;if(n)throw n;if(!r.session)throw new Is;const i=r.session;let o=null,a=null;"pkce"===this.flowType&&null!=e.email&&([o,a]=yield cr(this.storage,this.storageKey));const{data:l,error:c}=yield br(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:a}),jwt:i.access_token,xform:wr});if(c)throw c;return i.user=l.user,yield this._saveSession(i),yield this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}}))}catch(s){if(Ps(s))return{data:{user:null},error:s};throw s}})}setSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._setSession(e)}))})}_setSession(e){return u(this,null,function*(){try{if(!e.access_token||!e.refresh_token)throw new Is;const t=Date.now()/1e3;let s=t,r=!0,n=null;const{payload:i}=or(e.access_token);if(i.exp&&(s=i.exp,r=s<=t),r){const{session:t,error:s}=yield this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};n=t}else{const{data:r,error:i}=yield this._getUser(e.access_token);if(i)throw i;n={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},yield this._saveSession(n),yield this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(Ps(t))return{data:{session:null,user:null},error:t};throw t}})}refreshSession(e){return u(this,null,function*(){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._refreshSession(e)}))})}_refreshSession(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;if(!e){const{data:r,error:n}=t;if(n)throw n;e=null!==(s=r.session)&&void 0!==s?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new Is;const{session:r,error:n}=yield this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}}))}catch(t){if(Ps(t))return{data:{user:null,session:null},error:t};throw t}})}_getSessionFromURL(e,t){return u(this,null,function*(){try{if(!Xs())throw new Us("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Us(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new Ls("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new Us("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ls("No code detected.");const{data:t,error:s}=yield this._exchangeCodeForSession(e.code);if(s)throw s;const r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:r,access_token:n,refresh_token:i,expires_in:o,expires_at:a,token_type:l}=e;if(!(n&&o&&i&&l))throw new Us("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(o);let d=c+u;a&&(d=parseInt(a));const h=d-c;1e3*h<=_s&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${u}s`);const p=d-u;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,d,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,d,c);const{data:m,error:f}=yield this._getUser(n);if(f)throw f;const g={provider_token:s,provider_refresh_token:r,access_token:n,expires_in:u,expires_at:d,refresh_token:i,token_type:l,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(s){if(Ps(s))return{data:{session:null,redirectType:null},error:s};throw s}})}_isImplicitGrantCallback(e){return Boolean(e.access_token||e.error_description)}_isPKCECallback(e){return u(this,null,function*(){const t=yield rr(this.storage,`${this.storageKey}-code-verifier`);return!(!e.code||!t)})}signOut(){return u(this,arguments,function*(e={scope:"global"}){return yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){return yield this._signOut(e)}))})}_signOut(){return u(this,arguments,function*({scope:e}={scope:"global"}){return yield this._useSession(t=>u(this,null,function*(){var s;const{data:r,error:n}=t;if(n)return{error:n};const i=null===(s=r.session)||void 0===s?void 0:s.access_token;if(i){const{error:t}=yield this.admin.signOut(i,e);if(t&&(!function(e){return Ps(e)&&"AuthApiError"===e.name}(t)||404!==t.status&&401!==t.status&&403!==t.status))return{error:t}}return"others"!==e&&(yield this._removeSession(),yield nr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}}))})}onAuthStateChange(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(()=>{u(this,null,function*(){yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){this._emitInitialSession(t)}))})})(),{data:{subscription:s}}}_emitInitialSession(e){return u(this,null,function*(){return yield this._useSession(t=>u(this,null,function*(){var s,r;try{const{data:{session:r},error:n}=t;if(n)throw n;yield null===(s=this.stateChangeEmitters.get(e))||void 0===s?void 0:s.callback("INITIAL_SESSION",r),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(n){yield null===(r=this.stateChangeEmitters.get(e))||void 0===r?void 0:r.callback("INITIAL_SESSION",null),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}}))})}resetPasswordForEmail(e){return u(this,arguments,function*(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=yield cr(this.storage,this.storageKey,!0));try{return yield br(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(Ps(n))return{data:null,error:n};throw n}})}getUserIdentities(){return u(this,null,function*(){var e;try{const{data:t,error:s}=yield this.getUser();if(s)throw s;return{data:{identities:null!==(e=t.user.identities)&&void 0!==e?e:[]},error:null}}catch(t){if(Ps(t))return{data:null,error:t};throw t}})}linkIdentity(e){return u(this,null,function*(){var t;try{const{data:s,error:r}=yield this._useSession(t=>u(this,null,function*(){var s,r,n,i,o;const{data:a,error:l}=t;if(l)throw l;const c=yield this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null===(s=e.options)||void 0===s?void 0:s.redirectTo,scopes:null===(r=e.options)||void 0===r?void 0:r.scopes,queryParams:null===(n=e.options)||void 0===n?void 0:n.queryParams,skipBrowserRedirect:!0});return yield br(this.fetch,"GET",c,{headers:this.headers,jwt:null!==(o=null===(i=a.session)||void 0===i?void 0:i.access_token)&&void 0!==o?o:void 0})}));if(r)throw r;return Xs()&&!(null===(t=e.options)||void 0===t?void 0:t.skipBrowserRedirect)&&window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(s){if(Ps(s))return{data:{provider:e.provider,url:null},error:s};throw s}})}unlinkIdentity(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s,r;const{data:n,error:i}=t;if(i)throw i;return yield br(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!==(r=null===(s=n.session)||void 0===s?void 0:s.access_token)&&void 0!==r?r:void 0})}))}catch(t){if(Ps(t))return{data:null,error:t};throw t}})}_refreshAccessToken(e){return u(this,null,function*(){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return yield function(e,t){return new Promise((s,r)=>{(()=>{u(this,null,function*(){for(let i=0;i<1/0;i++)try{const r=yield e(i);if(!t(i,null,r))return void s(r)}catch(n){if(!t(i,n))return void r(n)}})})()})}(s=>u(this,null,function*(){return s>0&&(yield function(e){return u(this,null,function*(){return yield new Promise(t=>{setTimeout(()=>t(null),e)})})}(200*Math.pow(2,s-1))),this._debug(t,"refreshing attempt",s),yield br(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:yr})}),(e,t)=>{const r=200*Math.pow(2,e);return t&&qs(t)&&Date.now()+r-s<_s})}catch(s){if(this._debug(t,"error",s),Ps(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}})}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}_handleProviderSignIn(e,t){return u(this,null,function*(){const s=yield this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),Xs()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}})}_recoverAndRefresh(){return u(this,null,function*(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const n=yield rr(this.storage,this.storageKey);if(n&&this.userStorage){let t=yield rr(this.userStorage,this.storageKey+"-user");this.storage.isServer||!Object.is(this.storage,this.userStorage)||t||(t={user:n.user},yield sr(this.userStorage,this.storageKey+"-user",t)),n.user=null!==(e=null==t?void 0:t.user)&&void 0!==e?e:pr()}else if(n&&!n.user&&!n.user){const e=yield rr(this.storage,this.storageKey+"-user");e&&(null==e?void 0:e.user)?(n.user=e.user,yield nr(this.storage,this.storageKey+"-user"),yield sr(this.storage,this.storageKey,n)):n.user=pr()}if(this._debug(s,"session from storage",n),!this._isValidSession(n))return this._debug(s,"session is not valid"),void(null!==n&&(yield this._removeSession()));const i=1e3*(null!==(t=n.expires_at)&&void 0!==t?t:1/0)-Date.now()<js;if(this._debug(s,`session has${i?"":" not"} expired with margin of 90000s`),i){if(this.autoRefreshToken&&n.refresh_token){const{error:e}=yield this._callRefreshToken(n.refresh_token);e&&(console.error(e),qs(e)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",e),yield this._removeSession()))}}else if(n.user&&!0===n.user.__isUserNotAvailableProxy)try{const{data:e,error:t}=yield this._getUser(n.access_token);!t&&(null==e?void 0:e.user)?(n.user=e.user,yield this._saveSession(n),yield this._notifyAllSubscribers("SIGNED_IN",n)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(r){console.error("Error getting user data:",r),this._debug(s,"error getting user data, skipping SIGNED_IN notification",r)}else yield this._notifyAllSubscribers("SIGNED_IN",n)}catch(n){return this._debug(s,"error",n),void console.error(n)}finally{this._debug(s,"end")}})}_callRefreshToken(e){return u(this,null,function*(){var t,s;if(!e)throw new Is;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new ir;const{data:t,error:s}=yield this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new Is;yield this._saveSession(t.session),yield this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);const r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(n){if(this._debug(r,"error",n),Ps(n)){const e={session:null,error:n};return qs(n)||(yield this._removeSession()),null===(t=this.refreshingDeferred)||void 0===t||t.resolve(e),e}throw null===(s=this.refreshingDeferred)||void 0===s||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(r,"end")}})}_notifyAllSubscribers(e,t,s=!0){return u(this,null,function*(){const r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],n=Array.from(this.stateChangeEmitters.values()).map(s=>u(this,null,function*(){try{yield s.callback(e,t)}catch(n){r.push(n)}}));if(yield Promise.all(n),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}})}_saveSession(e){return u(this,null,function*(){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&!0===t.user.__isUserNotAvailableProxy;if(this.userStorage){!s&&t.user&&(yield sr(this.userStorage,this.storageKey+"-user",{user:t.user}));const e=Object.assign({},t);delete e.user;const r=mr(e);yield sr(this.storage,this.storageKey,r)}else{const e=mr(t);yield sr(this.storage,this.storageKey,e)}})}_removeSession(){return u(this,null,function*(){this._debug("#_removeSession()"),yield nr(this.storage,this.storageKey),yield nr(this.storage,this.storageKey+"-code-verifier"),yield nr(this.storage,this.storageKey+"-user"),this.userStorage&&(yield nr(this.userStorage,this.storageKey+"-user")),yield this._notifyAllSubscribers("SIGNED_OUT",null)})}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Xs()&&(null===window||void 0===window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}_startAutoRefresh(){return u(this,null,function*(){yield this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),_s);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"undefined"!=typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(()=>u(this,null,function*(){yield this.initializePromise,yield this._autoRefreshTokenTick()}),0)})}_stopAutoRefresh(){return u(this,null,function*(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)})}startAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._startAutoRefresh()})}stopAutoRefresh(){return u(this,null,function*(){this._removeVisibilityChangedCallback(),yield this._stopAutoRefresh()})}_autoRefreshTokenTick(){return u(this,null,function*(){this._debug("#_autoRefreshTokenTick()","begin");try{yield this._acquireLock(0,()=>u(this,null,function*(){try{const t=Date.now();try{return yield this._useSession(e=>u(this,null,function*(){const{data:{session:s}}=e;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");const r=Math.floor((1e3*s.expires_at-t)/_s);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&(yield this._callRefreshToken(s.refresh_token))}))}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}}))}catch(e){if(!(e.isAcquireTimeout||e instanceof Pr))throw e;this._debug("auto refresh token tick lock not available")}})}_handleVisibilityChange(){return u(this,null,function*(){if(this._debug("#_handleVisibilityChange()"),!Xs()||!(null===window||void 0===window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=()=>u(this,null,function*(){return yield this._onVisibilityChanged(!1)}),null===window||void 0===window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),yield this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}})}_onVisibilityChanged(e){return u(this,null,function*(){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(yield this.initializePromise,yield this._acquireLock(-1,()=>u(this,null,function*(){"visible"===document.visibilityState?yield this._recoverAndRefresh():this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting")})))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()})}_getUrlForProvider(e,t,s){return u(this,null,function*(){const r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){const[e,t]=yield cr(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){const e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`})}_unenroll(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;const{data:r,error:n}=t;return n?{data:null,error:n}:yield br(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(Ps(t))return{data:null,error:t};throw t}})}_enroll(e){return u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s,r;const{data:n,error:i}=t;if(i)return{data:null,error:i};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:a,error:l}=yield br(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:null===(s=null==n?void 0:n.session)||void 0===s?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null===(r=null==a?void 0:a.totp)||void 0===r?void 0:r.qr_code)&&(a.totp.qr_code=`data:image/svg+xml;utf-8,${a.totp.qr_code}`),{data:a,error:null})}))}catch(t){if(Ps(t))return{data:null,error:t};throw t}})}_verify(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;const{data:r,error:n}=t;if(n)return{data:null,error:n};const{data:i,error:o}=yield br(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token});return o?{data:null,error:o}:(yield this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),yield this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:o})}))}catch(t){if(Ps(t))return{data:null,error:t};throw t}}))})}_challenge(e){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){try{return yield this._useSession(t=>u(this,null,function*(){var s;const{data:r,error:n}=t;return n?{data:null,error:n}:yield br(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null===(s=null==r?void 0:r.session)||void 0===s?void 0:s.access_token})}))}catch(t){if(Ps(t))return{data:null,error:t};throw t}}))})}_challengeAndVerify(e){return u(this,null,function*(){const{data:t,error:s}=yield this._challenge({factorId:e.factorId});return s?{data:null,error:s}:yield this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})})}_listFactors(){return u(this,null,function*(){const{data:{user:e},error:t}=yield this.getUser();if(t)return{data:null,error:t};const s=(null==e?void 0:e.factors)||[],r=s.filter(e=>"totp"===e.factor_type&&"verified"===e.status),n=s.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:s,totp:r,phone:n},error:null}})}_getAuthenticatorAssuranceLevel(){return u(this,null,function*(){return this._acquireLock(-1,()=>u(this,null,function*(){return yield this._useSession(e=>u(this,null,function*(){var t,s;const{data:{session:r},error:n}=e;if(n)return{data:null,error:n};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:i}=or(r.access_token);let o=null;i.aal&&(o=i.aal);let a=o;return(null!==(s=null===(t=r.user.factors)||void 0===t?void 0:t.filter(e=>"verified"===e.status))&&void 0!==s?s:[]).length>0&&(a="aal2"),{data:{currentLevel:o,nextLevel:a,currentAuthenticationMethods:i.amr||[]},error:null}}))}))})}fetchJwk(e){return u(this,arguments,function*(e,t={keys:[]}){let s=t.keys.find(t=>t.kid===e);if(s)return s;const r=Date.now();if(s=this.jwks.keys.find(t=>t.kid===e),s&&this.jwks_cached_at+6e5>r)return s;const{data:n,error:i}=yield br(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return n.keys&&0!==n.keys.length?(this.jwks=n,this.jwks_cached_at=r,s=n.keys.find(t=>t.kid===e),s||null):null})}getClaims(e){return u(this,arguments,function*(e,t={}){try{let s=e;if(!s){const{data:e,error:t}=yield this.getSession();if(t||!e.session)return{data:null,error:t};s=e.session.access_token}const{header:r,payload:n,signature:i,raw:{header:o,payload:a}}=or(s);(null==t?void 0:t.allowExpired)||function(e){if(!e)throw new Error("Missing exp claim");if(e<=Math.floor(Date.now()/1e3))throw new Error("JWT has expired")}(n.exp);const l=r.alg&&!r.alg.startsWith("HS")&&r.kid&&"crypto"in globalThis&&"subtle"in globalThis.crypto?yield this.fetchJwk(r.kid,(null==t?void 0:t.keys)?{keys:t.keys}:null==t?void 0:t.jwks):null;if(!l){const{error:e}=yield this.getUser(s);if(e)throw e;return{data:{claims:n,header:r,signature:i},error:null}}const c=function(e){switch(e){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}(r.alg),u=yield crypto.subtle.importKey("jwk",l,c,!0,["verify"]);if(!(yield crypto.subtle.verify(c,u,i,Ys(`${o}.${a}`))))throw new zs("Invalid JWT signature");return{data:{claims:n,header:r,signature:i},error:null}}catch(s){if(Ps(s))return{data:null,error:s};throw s}})}}$r.nextInstanceID=0;const Ur=$r;class Lr extends Ur{constructor(e){super(e)}}var Dr=function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{l(r.next(e))}catch(t){i(t)}}function a(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s(function(e){e(t)})).then(o,a)}l((r=r.apply(e,t||[])).next())})};class qr{constructor(e,t,s){var r,n,i;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=(a=e).endsWith("/")?a:a+"/";var a;const l=new URL(o);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u=function(e,t){var s,r;const{db:n,auth:i,realtime:o,global:a}=e,{db:l,auth:c,realtime:u,global:d}=t,h={db:Object.assign(Object.assign({},l),n),auth:Object.assign(Object.assign({},c),i),realtime:Object.assign(Object.assign({},u),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),a),{headers:Object.assign(Object.assign({},null!==(s=null==d?void 0:d.headers)&&void 0!==s?s:{}),null!==(r=null==a?void 0:a.headers)&&void 0!==r?r:{})}),accessToken:()=>xs(this,void 0,void 0,function*(){return""})};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:fs,realtime:vs,auth:Object.assign(Object.assign({},gs),{storageKey:c}),global:ms});this.storageKey=null!==(r=u.auth.storageKey)&&void 0!==r?r:"",this.headers=null!==(n=u.global.headers)&&void 0!==n?n:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!==(i=u.auth)&&void 0!==i?i:{},this.headers,u.global.fetch),this.fetch=ys(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new He(new URL("rest/v1",l).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),this.storage=new hs(this.storageUrl.href,this.headers,this.fetch,null==s?void 0:s.storage),u.accessToken||this._listenForAuthEvents()}get functions(){return new oe(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Dr(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return null!==(t=null===(e=s.session)||void 0===e?void 0:e.access_token)&&void 0!==t?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:n,flowType:i,lock:o,debug:a},l,c){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Lr({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:i,lock:o,debug:a,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new Bt(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){"TOKEN_REFRESHED"!==e&&"SIGNED_IN"!==e||this.changedAccessToken===s?"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0):this.changedAccessToken=s}}(function(){if("undefined"!=typeof window)return!1;if("undefined"==typeof process)return!1;const e=process.version;if(null==e)return!1;const t=e.match(/^v(\d+)\./);return!!t&&parseInt(t[1],10)<=18})()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Mr="https://ifmsgujvbfibbnjmhcey.supabase.co",zr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlmbXNndWp2YmZpYmJuam1oY2V5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzMxMjIsImV4cCI6MjA3MDkwOTEyMn0.Pjf9hxO_jA-NXM8RvQ445RrAyZTm1HdDgROcj9nsZPI";(Mr.includes("your-project")||zr.includes("your-anon-key"))&&(console.error("Missing Supabase environment variables. Please configure VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY"),console.log("Current values:",{supabaseUrl:Mr,supabaseAnonKey:"[SET]"}),"undefined"!=typeof window&&console.error("🔥 ERREUR PRODUCTION: Variables Supabase manquantes sur romainflg.fr"));const Br=new qr(Mr,zr,Fr);var Fr;const Jr=d.createContext(void 0);function Wr({children:e}){const[t,s]=d.useState(null),[r,n]=d.useState(null),[i,o]=d.useState(!0);return d.useEffect(()=>{Br.auth.getSession().then(({data:{session:e}})=>{var t;n(e),s(null!=(t=null==e?void 0:e.user)?t:null),o(!1)});const{data:{subscription:e}}=Br.auth.onAuthStateChange((e,t)=>{var r;n(t),s(null!=(r=null==t?void 0:t.user)?r:null),o(!1)});return()=>e.unsubscribe()},[]),K.jsx(Jr.Provider,{value:{user:t,session:r,loading:i,signIn:(e,t)=>u(this,null,function*(){if("https://ifmsgujvbfibbnjmhcey.supabase.co".includes("your-project")||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlmbXNndWp2YmZpYmJuam1oY2V5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzMxMjIsImV4cCI6MjA3MDkwOTEyMn0.Pjf9hxO_jA-NXM8RvQ445RrAyZTm1HdDgROcj9nsZPI".includes("your-anon-key"))throw new Error("🔥 Configuration Supabase manquante sur romainflg.fr. Les variables d'environnement VITE_SUPABASE_URL et VITE_SUPABASE_ANON_KEY doivent être configurées sur votre hébergeur.");const{error:s}=yield Br.auth.signInWithPassword({email:e,password:t});if(s)throw s}),signUp:(e,t,s)=>u(this,null,function*(){if("https://ifmsgujvbfibbnjmhcey.supabase.co".includes("your-project")||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlmbXNndWp2YmZpYmJuam1oY2V5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzMxMjIsImV4cCI6MjA3MDkwOTEyMn0.Pjf9hxO_jA-NXM8RvQ445RrAyZTm1HdDgROcj9nsZPI".includes("your-anon-key"))throw new Error("🔥 Configuration Supabase manquante sur romainflg.fr. Les variables d'environnement VITE_SUPABASE_URL et VITE_SUPABASE_ANON_KEY doivent être configurées sur votre hébergeur.");const{error:r}=yield Br.auth.signUp({email:e,password:t,options:{data:{username:s}}});if(r)throw r}),signOut:()=>u(this,null,function*(){yield Br.auth.signOut()})},children:e})}const Kr=()=>{const e=d.useContext(Jr);if(void 0===e)throw new Error("useAuth must be used within an AuthProvider");return e};function Vr(e="romainflg"){const{user:t}=Kr(),[s,r]=d.useState(null),[n,i]=d.useState(null),[o,a]=d.useState(!0),[l,c]=d.useState(null),h=()=>u(this,null,function*(){if("https://ifmsgujvbfibbnjmhcey.supabase.co".includes("your-project")||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlmbXNndWp2YmZpYmJuam1oY2V5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzMxMjIsImV4cCI6MjA3MDkwOTEyMn0.Pjf9hxO_jA-NXM8RvQ445RrAyZTm1HdDgROcj9nsZPI".includes("your-anon-key"))return r(null),i(null),a(!1),void c("Configuration Supabase manquante. Veuillez configurer les variables d'environnement VITE_SUPABASE_URL et VITE_SUPABASE_ANON_KEY.");if(!t)return r(null),i(null),void a(!1);try{a(!0),c(null);const{data:s,error:n}=yield Br.from("global_users").select("*").eq("auth_user_id",t.id).single();if(n)throw n;r(s);const{data:o,error:l}=yield Br.from("site_user_profiles").select("*").eq("global_user_id",s.id).eq("site_name",e).single();if(l&&"PGRST116"!==l.code)throw l;if(o)i(o);else{const{data:t,error:r}=yield Br.from("site_user_profiles").insert({global_user_id:s.id,site_name:e,description:"",site_specific_data:{}}).select().single();if(r)throw r;i(t)}}catch(s){console.error("Erreur lors du chargement du profil:",s),c(s.message||"Erreur lors du chargement du profil")}finally{a(!1)}});return d.useEffect(()=>{h()},[t,e]),{globalUser:s,siteProfile:n,loading:o,error:l,updateGlobalProfile:e=>u(this,null,function*(){if(!s)throw new Error("Aucun profil global trouvé");try{const{data:t,error:n}=yield Br.from("global_users").update(e).eq("id",s.id).select().single();if(n)throw n;r(t)}catch(t){throw console.error("Erreur lors de la mise à jour du profil global:",t),t}}),updateSiteProfile:e=>u(this,null,function*(){if(!n)throw new Error("Aucun profil site trouvé");try{const{data:t,error:s}=yield Br.from("site_user_profiles").update(e).eq("id",n.id).select().single();if(s)throw s;i(t)}catch(t){throw console.error("Erreur lors de la mise à jour du profil site:",t),t}}),refreshProfile:()=>u(this,null,function*(){yield h()})}}function Gr({isOpen:e,onClose:t,initialMode:s="signin"}){const[r,n]=d.useState(s),[i,o]=d.useState({email:"",password:"",username:""}),[a,h]=d.useState(!1),[p,m]=d.useState(null),{signIn:f,signUp:_}=Kr();if(!e)return null;const j=e=>{o(c(l({},i),{[e.target.name]:e.target.value}))};return K.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:K.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-md w-full",children:[K.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[K.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"signin"===r?"Connexion":"Inscription"}),K.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:K.jsx(g,{className:"h-6 w-6 text-gray-500"})})]}),K.jsxs("form",{onSubmit:e=>u(this,null,function*(){var s,n,o,a;e.preventDefault(),h(!0),m(null);const l=i.email.trim(),c=i.password.trim(),u=i.username.trim();try{if("signin"===r)yield f(l,c),t();else{if(!u)return void m("Le nom d'utilisateur est requis");yield _(l,c,u),t()}}catch(d){console.error("Erreur d'authentification:",d),"Invalid login credentials"===d.message?m("Email ou mot de passe incorrect."):(null==(s=d.message)?void 0:s.includes("Database error saving new user"))||"unexpected_failure"===d.code?m("Erreur lors de la création du compte. Le système d'authentification a été mis à jour. Veuillez réessayer dans quelques secondes."):(null==(n=d.message)?void 0:n.includes("User already registered"))?m("Un compte avec cet email existe déjà. Essayez de vous connecter."):(null==(o=d.message)?void 0:o.includes("duplicate key"))||(null==(a=d.message)?void 0:a.includes("already exists"))?m("Ce nom d'utilisateur ou cet email est déjà utilisé. Essayez avec des informations différentes."):m(d.message||"Une erreur est survenue. Veuillez réessayer.")}finally{h(!1)}}),className:"p-6 space-y-4",children:[p&&K.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:K.jsx("p",{className:"text-red-800 text-sm",children:p})}),"signup"===r&&K.jsxs("div",{children:[K.jsxs("label",{className:"flex items-center space-x-2 text-sm font-medium text-gray-700 mb-2",children:[K.jsx(v,{className:"h-4 w-4"}),K.jsx("span",{children:"Nom d'utilisateur"})]}),K.jsx("input",{type:"text",name:"username",value:i.username,onChange:j,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Votre nom d'utilisateur"})]}),K.jsxs("div",{children:[K.jsxs("label",{className:"flex items-center space-x-2 text-sm font-medium text-gray-700 mb-2",children:[K.jsx(b,{className:"h-4 w-4"}),K.jsx("span",{children:"Email"})]}),K.jsx("input",{type:"email",name:"email",value:i.email,onChange:j,required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"votre@email.com"})]}),K.jsxs("div",{children:[K.jsxs("label",{className:"flex items-center space-x-2 text-sm font-medium text-gray-700 mb-2",children:[K.jsx(y,{className:"h-4 w-4"}),K.jsx("span",{children:"Mot de passe"})]}),K.jsx("input",{type:"password",name:"password",value:i.password,onChange:j,required:!0,minLength:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"••••••••"})]}),K.jsx("button",{type:"submit",disabled:a,className:"w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:a?K.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):K.jsxs(K.Fragment,{children:["signin"===r?K.jsx(x,{className:"h-5 w-5"}):K.jsx(w,{className:"h-5 w-5"}),K.jsx("span",{children:"signin"===r?"Se connecter":"S'inscrire"})]})}),K.jsx("div",{className:"text-center",children:K.jsx("button",{type:"button",onClick:()=>{n("signin"===r?"signup":"signin"),m(null)},className:"text-blue-600 hover:text-blue-700 text-sm font-medium",children:"signin"===r?"Pas encore de compte ? S'inscrire":"Déjà un compte ? Se connecter"})})]})]})})}function Hr(){const{user:e,loading:t}=Kr(),{globalUser:s,loading:r,error:n}=Vr("romainflg"),{projects:i}=Y(),[o,a]=f.useState(!1),[l,c]=f.useState(!1);return K.jsxs(K.Fragment,{children:[K.jsx("nav",{className:"fixed top-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-b border-gray-200 z-50",children:K.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 lg:px-8",children:K.jsxs("div",{className:"flex items-center justify-between h-16",children:[K.jsxs("a",{href:"/",className:"flex items-center space-x-2 text-xl sm:text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent hover:from-blue-700 hover:to-purple-700 transition-all",children:[K.jsx(_,{className:"h-5 w-5 sm:h-6 sm:w-6 text-blue-600"}),K.jsx("span",{children:"Romain FLG"})]}),K.jsx("div",{className:"flex items-center space-x-3",children:K.jsxs("button",{onClick:()=>c(!l),className:"p-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors relative",children:[l?K.jsx(g,{className:"h-5 w-5"}):K.jsx(j,{className:"h-5 w-5"}),e&&!t&&!r&&K.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]})})]})})}),l&&K.jsx("div",{className:"fixed top-16 left-0 right-0 bg-white border-b border-gray-200 shadow-lg z-40",children:K.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 lg:px-8 py-4",children:K.jsxs("div",{className:"space-y-3",children:[K.jsxs("div",{children:[K.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Compte"}),K.jsxs("div",{className:"space-y-1",children:[t||r&&!n?K.jsxs("div",{className:"flex items-center space-x-3 px-3 py-2",children:[K.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),K.jsx("span",{className:"text-gray-600",children:"Chargement..."})]}):e&&s&&!n?K.jsxs("a",{href:"/profile",className:"flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",onClick:()=>c(!1),children:[K.jsx("img",{src:(null==s?void 0:s.profile_photo_url)||"/profile-photos/default-avatar.png",alt:"Photo de profil",className:"w-6 h-6 rounded-full object-cover border border-gray-200",onError:e=>{const t=e.target;"/profile-photos/default-avatar.png"!==t.src&&(t.src="/profile-photos/default-avatar.png")}}),K.jsx("span",{className:"font-medium",children:"Mon Profil"}),K.jsxs("span",{className:"text-sm text-gray-500",children:["(",null==s?void 0:s.username,")"]})]}):K.jsxs("button",{onClick:()=>{a(!0),c(!1)},className:"flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors w-full text-left",children:[K.jsx(v,{className:"h-6 w-6 text-blue-600"}),K.jsx("span",{className:"font-medium",children:"Se connecter"})]}),n&&K.jsxs("div",{className:"px-3 py-2 text-sm text-amber-600 bg-amber-50 rounded-lg",children:[K.jsx("p",{className:"font-medium",children:"⚠️ Configuration requise"}),K.jsx("p",{className:"text-xs mt-1",children:"Variables Supabase manquantes"})]})]})]}),K.jsx("hr",{className:"border-gray-200"}),K.jsxs("div",{children:[K.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Projets"}),K.jsx("div",{className:"space-y-1",children:i.map(e=>K.jsxs("a",{href:e.websiteUrl,target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",onClick:()=>c(!1),children:[K.jsx("img",{src:e.image,alt:e.name,className:"w-6 h-6 object-contain"}),K.jsx("span",{className:"font-medium",children:e.name}),K.jsx(k,{className:"h-4 w-4 text-gray-400"})]},e.id))})]}),K.jsx("hr",{className:"border-gray-200"}),K.jsxs("div",{children:[K.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Services"}),K.jsxs("div",{className:"space-y-1",children:[K.jsxs("a",{href:"https://romainflg.fr/flg-pass",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",onClick:()=>c(!1),children:[K.jsx(S,{className:"h-5 w-5 text-blue-600"}),K.jsx("span",{className:"font-medium",children:"FLG PASS"}),K.jsx(k,{className:"h-4 w-4 text-gray-400"})]}),K.jsxs("a",{href:"https://romainflg.fr/credits",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-3 px-3 py-2 text-gray-700 hover:bg-gray-50 rounded-lg transition-colors",onClick:()=>c(!1),children:[K.jsx(N,{className:"h-5 w-5 text-green-600"}),K.jsx("span",{className:"font-medium",children:"Crédits"}),K.jsx(k,{className:"h-4 w-4 text-gray-400"})]})]})]})]})})}),l&&K.jsx("div",{className:"fixed inset-0 bg-black/20 z-30",onClick:()=>c(!1)}),K.jsx(Gr,{isOpen:o,onClose:()=>a(!1)})]})}function Yr(){const{projects:e,loading:t}=Y();return t?K.jsxs("div",{className:"min-h-screen",children:[K.jsxs("section",{className:"relative py-20 px-4 overflow-hidden",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-800"}),K.jsx("div",{className:"absolute inset-0 bg-black/20"}),K.jsxs("div",{className:"relative max-w-4xl mx-auto text-center text-white",children:[K.jsxs("h1",{className:"text-5xl md:text-6xl font-bold mb-6 leading-tight",children:["Bienvenue sur",K.jsx("span",{className:"block bg-gradient-to-r from-yellow-300 to-orange-400 bg-clip-text text-transparent",children:"Romain FLG"})]}),K.jsx("p",{className:"text-xl md:text-2xl text-blue-100 mb-8 font-medium",children:"Créativité • Innovation • Entrepreneuriat"}),K.jsx("p",{className:"text-2xl md:text-3xl text-blue-100 mb-4 font-semibold",children:"Le site qui centralise tous mes projets"})]})]}),K.jsx("section",{className:"py-12 sm:py-16 px-4",children:K.jsxs("div",{className:"max-w-7xl mx-auto text-center",children:[K.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),K.jsx("p",{className:"text-gray-600",children:"Chargement des projets..."})]})})]}):K.jsxs("div",{className:"min-h-screen",children:[K.jsxs("section",{className:"relative py-20 px-4 overflow-hidden",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-600 via-purple-600 to-indigo-800"}),K.jsx("div",{className:"absolute inset-0 bg-black/20"}),K.jsxs("div",{className:"relative max-w-4xl mx-auto text-center text-white px-4",children:[K.jsxs("h1",{className:"text-4xl sm:text-5xl md:text-6xl font-bold mb-6 leading-tight",children:["Bienvenue sur",K.jsx("span",{className:"block bg-gradient-to-r from-yellow-300 to-orange-400 bg-clip-text text-transparent",children:"Romain FLG"})]}),K.jsx("div",{className:"flex flex-col sm:flex-row justify-center items-center gap-16 sm:gap-4 mt-0 mb-0",children:K.jsxs("div",{className:"flex flex-row justify-center items-center gap-4 mt-2 mb-1",children:[K.jsxs("a",{href:"https://romainflg.fr/flg-pass",target:"_blank",rel:"noopener noreferrer",className:"group relative overflow-hidden bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 font-bold text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 border border-blue-400/20 w-32 sm:w-auto text-center",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),K.jsx("span",{className:"relative z-10",children:"FLG PASS"}),K.jsx("div",{className:"absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-white/5 to-transparent transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"})]}),K.jsxs("a",{href:"https://romainflg.fr/credits",target:"_blank",rel:"noopener noreferrer",className:"group relative overflow-hidden bg-gradient-to-r from-emerald-500 to-teal-600 text-white px-6 py-3 rounded-lg hover:from-emerald-600 hover:to-teal-700 transition-all duration-300 font-bold text-sm sm:text-base shadow-lg hover:shadow-xl transform hover:scale-105 border border-emerald-400/20 w-32 sm:w-auto text-center",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),K.jsx("span",{className:"relative z-10",children:"CRÉDITS"}),K.jsx("div",{className:"absolute inset-0 rounded-lg bg-gradient-to-r from-transparent via-white/5 to-transparent transform -skew-x-12 -translate-x-full group-hover:translate-x-full transition-transform duration-700"})]})]})})]})]}),K.jsx("section",{className:"py-12 sm:py-16 px-4",children:K.jsx("div",{className:"max-w-7xl mx-auto",children:0===e.length?K.jsxs("div",{className:"text-center py-12",children:[K.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Aucun projet disponible"}),K.jsx("p",{className:"text-gray-600",children:"Les projets seront bientôt disponibles !"})]}):K.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8",children:[...e].reverse().map((t,s)=>K.jsxs("div",{className:"group bg-white rounded-xl sm:rounded-2xl shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-2 overflow-hidden",children:[K.jsxs("div",{className:"relative overflow-hidden",children:[K.jsx("img",{src:t.image,alt:t.name,className:"w-full h-48 sm:h-56 md:h-64 object-contain bg-gray-100 group-hover:scale-105 transition-transform duration-300 p-4"}),K.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),K.jsxs("div",{className:"p-4 sm:p-6",children:[K.jsx("div",{className:"flex items-center justify-between mb-3",children:K.jsxs("span",{className:"text-xs sm:text-sm font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded-full",children:["Projet ",e.length-s]})}),K.jsx("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-3 group-hover:text-blue-600 transition-colors",children:t.name}),K.jsx("p",{className:"text-sm sm:text-base text-gray-600 mb-4 leading-relaxed",children:t.description.split("\n").map((e,s)=>K.jsxs("span",{children:[e,s<t.description.split("\n").length-1&&K.jsx("br",{})]},s))}),K.jsxs(D,{to:`/project/${t.slug}`,className:"inline-flex items-center justify-center w-full sm:w-auto space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 font-medium group-hover:shadow-lg text-sm sm:text-base",children:[K.jsx("span",{children:"Voir le projet"}),K.jsx(T,{className:"h-4 w-4 group-hover:translate-x-1 transition-transform"})]})]})]},t.id))})})})]})}function Zr({isOpen:e,onClose:t,projectName:s,preselectedPosition:r="CM"}){const[n,i]=d.useState({name:"",email:"",position:r,motivation:"",creativity:"",universeModel:"",tiktok:"",telegram:""}),[o,a]=d.useState(!1),[h,p]=d.useState(!1),[m,y]=d.useState(null);if(f.useEffect(()=>{i(e=>c(l({},e),{position:r}))},[r]),!e)return null;const x=e=>{i(c(l({},n),{[e.target.name]:e.target.value}))};return h?K.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:K.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl p-6 sm:p-8 max-w-md w-full text-center",children:[K.jsx("div",{className:"w-12 h-12 sm:w-16 sm:h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:K.jsx(E,{className:"h-8 w-8 text-green-600"})}),K.jsx("h3",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-2",children:"Candidature envoyée !"}),K.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:"Votre candidature a été envoyée avec succès ! Vous recevrez une réponse par email."})]})}):K.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-2 sm:p-4",children:K.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-2xl max-w-2xl w-full max-h-[95vh] sm:max-h-[90vh] overflow-y-auto",children:[K.jsxs("div",{className:"flex items-center justify-between p-4 sm:p-6 border-b border-gray-200",children:[K.jsxs("h2",{className:"text-lg sm:text-2xl font-bold text-gray-900 pr-4",children:["Postuler pour ",s]}),K.jsx("button",{onClick:t,className:"p-1.5 sm:p-2 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0",children:K.jsx(g,{className:"h-5 w-5 sm:h-6 sm:w-6 text-gray-500"})})]}),K.jsx("div",{className:"p-4 sm:p-6 bg-gradient-to-r from-purple-50 to-pink-50 border-b border-purple-100",children:K.jsxs("div",{className:"flex items-start space-x-3",children:[K.jsx("div",{className:"p-1.5 sm:p-2 bg-purple-600 rounded-lg flex-shrink-0",children:K.jsx(P,{className:"h-5 w-5 text-white"})}),K.jsxs("div",{children:[K.jsx("h3",{className:"font-semibold text-purple-900 mb-2 text-sm sm:text-base",children:"🎯 Poste : Community Manager (20% commission)"}),K.jsxs("p",{className:"text-purple-800 text-xs sm:text-sm leading-relaxed",children:["Pour devenir un des 3 CM du projet, vous devrez ",K.jsx("strong",{children:"créer un compte TikTok dédié exclusivement au projet"})," et vous démarquer par votre créativité. Une fois le poste obtenu, vous devrez maintenir une fréquence de ",K.jsx("strong",{children:"1 à 3 TikToks par jour"})," pour promouvoir le projet, animer la communauté, et contribuer à la croissance de l'audience. En échange de cet investissement créatif et communautaire, vous recevrez ",K.jsx("strong",{children:"un code promo personnel et toucherez 20% de commission sur toutes les ventes où votre code promo a été utilisé"}),"."]})]})]})}),K.jsx("div",{className:"p-4 sm:p-6 bg-blue-50 border-b border-blue-100",children:K.jsxs("div",{className:"flex items-start space-x-3",children:[K.jsx("div",{className:"p-1.5 sm:p-2 bg-blue-600 rounded-lg flex-shrink-0",children:K.jsx(P,{className:"h-5 w-5 text-white"})}),K.jsxs("div",{children:[K.jsx("h3",{className:"font-semibold text-blue-900 mb-2 text-sm sm:text-base",children:"💡 Conseil pour maximiser vos chances"}),K.jsx("p",{className:"text-blue-800 text-xs sm:text-sm leading-relaxed",children:"Rejoignez le Telegram pour vous démarquer ! Partagez vos TikToks, proposez des idées innovantes et montrez votre valeur ajoutée. C'est le meilleur moyen de prouver votre motivation et vos compétences."})]})]})}),K.jsxs("form",{onSubmit:e=>u(this,null,function*(){e.preventDefault(),a(!0),y(null);try{const e={project_name:s||"",name:n.name||"",email:n.email||"",position:n.position||"",telegram:n.telegram||"",tiktok:n.tiktok||"",motivation:n.motivation||"",creativity:n.creativity||"",universe_model:n.universeModel||""},r=yield fetch("https://formspree.io/f/xeozdabg",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok)throw yield r.text(),new Error(`Erreur ${r.status}: ${r.statusText}`);p(!0),setTimeout(()=>{p(!1),t(),i({name:"",email:"",position:"COO",motivation:"",creativity:"",universeModel:"",tiktok:"",telegram:""})},3e3)}catch(r){y(`Erreur: ${r instanceof Error?r.message:"Problème de connexion"}`)}finally{a(!1)}}),className:"p-4 sm:p-6 space-y-4 sm:space-y-6",children:[m&&K.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:K.jsx("p",{className:"text-red-800 text-sm",children:m})}),K.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[K.jsxs("div",{children:[K.jsxs("label",{className:"flex items-center space-x-2 text-xs sm:text-sm font-medium text-gray-700 mb-2",children:[K.jsx(v,{className:"h-4 w-4"}),K.jsx("span",{children:"Nom complet *"})]}),K.jsx("input",{type:"text",name:"name",value:n.name,onChange:x,required:!0,className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base",placeholder:"Votre nom complet"})]}),K.jsxs("div",{children:[K.jsxs("label",{className:"flex items-center space-x-2 text-xs sm:text-sm font-medium text-gray-700 mb-2",children:[K.jsx(b,{className:"h-4 w-4"}),K.jsx("span",{children:"Email *"})]}),K.jsx("input",{type:"email",name:"email",value:n.email,onChange:x,required:!0,className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base",placeholder:"votre@email.com"})]})]}),K.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[K.jsxs("div",{children:[K.jsx("label",{className:"text-xs sm:text-sm font-medium text-gray-700 mb-2 block",children:"Nom Telegram *"}),K.jsx("input",{type:"text",name:"telegram",value:n.telegram,onChange:x,required:!0,className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base",placeholder:"@votre_nom_telegram"})]}),K.jsxs("div",{children:[K.jsx("label",{className:"text-xs sm:text-sm font-medium text-gray-700 mb-2 block",children:"Nom d'utilisateur TikTok *"}),K.jsx("input",{type:"text",name:"tiktok",value:n.tiktok,onChange:x,required:!0,className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm sm:text-base",placeholder:`@${s.replace(/\s+/g,"").toLowerCase()}pseudo`})]})]}),K.jsxs("div",{children:[K.jsxs("label",{className:"flex items-center space-x-2 text-xs sm:text-sm font-medium text-gray-700 mb-2",children:[K.jsx(P,{className:"h-4 w-4"}),K.jsx("span",{children:"Motivation *"})]}),K.jsx("textarea",{name:"motivation",value:n.motivation,onChange:x,required:!0,rows:4,className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm sm:text-base",placeholder:"Pourquoi voulez-vous rejoindre ce projet ? Quelle valeur pouvez-vous apporter ?"})]}),K.jsxs("div",{children:[K.jsx("label",{className:"text-xs sm:text-sm font-medium text-gray-700 mb-2 block",children:"Définir la créativité (optionnel)"}),K.jsx("textarea",{name:"creativity",value:n.creativity,onChange:x,rows:4,className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm sm:text-base",placeholder:"Comment définissez-vous la créativité ? Comment pensez-vous qu'elle fonctionne ? Que faites-vous pour la provoquer ou la stimuler ? Donnez votre vision personnelle..."})]}),K.jsxs("div",{children:[K.jsx("label",{className:"text-xs sm:text-sm font-medium text-gray-700 mb-2 block",children:"Imaginez un modèle d'univers créatif (optionnel)"}),K.jsx("p",{className:"text-xs text-gray-600 mb-3 leading-relaxed",children:"Créez un univers imaginaire qui n'a pas besoin de correspondre au nôtre. L'objectif est d'observer votre façon d'imaginer et de connecter vos idées. Vous pouvez lire l'exemple ci-dessous pour mieux comprendre l'exercice."}),K.jsx("textarea",{name:"universeModel",value:n.universeModel,onChange:x,rows:6,className:"w-full px-3 sm:px-4 py-2.5 sm:py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-sm sm:text-base",placeholder:"Dans ce modèle, toutes les galaxies sont les souvenirs de « Dieu ». Chaque galaxie possède en son centre un trou noir, sauf une : la galaxie du présent, unique, qui abrite un trou blanc.\n\nCe trou blanc a un double rôle : il maintient les astres en orbite et expulse directement les astres collectées par tous les autres trous noirs de l'univers.\n\nUne fois que la galaxie du présent est suffisamment remplie, un nouveau trou blanc apparaît quelque part dans l'univers. Ce nouvel astre devient le cœur de la nouvelle galaxie du présent, tandis que celle qui l'était juste avant, devient une des galaxies du passé.\n\nDans ce modèle, le passé et le futur sont une seule et même chose : chaque souvenir, chaque galaxie du passé est aussi un fragment du futur, et chaque futur nourrit, à son tour, la galaxie du présent.\n\nCe modèle d'univers a été pensé autour du biais cognitif d'heuristique de disponibilité : plus un souvenir est facilement accessible, plus il influence nos choix et notre perception du présent. De la même manière, dans cet univers, les astres les plus proches des trous noirs des galaxies du passé sont plus susceptibles d'entrer dans la galaxie du présent.\n\nDans ce modèle d'univers, « Dieu » est en quelque sorte dans un rêve, à la fois l'environnement et l'architecte de ce qu'il est en train de construire. Le futur et le passé sont prédéfini dans ce monde ou le destin semble inévitable."})]}),K.jsxs("div",{className:"flex space-x-4 pt-4",children:[K.jsx("button",{type:"button",onClick:t,disabled:o,className:"flex-1 px-4 sm:px-6 py-2.5 sm:py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium text-sm sm:text-base",children:"Annuler"}),K.jsx("button",{type:"submit",disabled:o,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 text-sm sm:text-base",children:o?K.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):K.jsxs(K.Fragment,{children:[K.jsx(E,{className:"h-5 w-5"}),K.jsx("span",{children:"Envoyer ma candidature"})]})})]})]})]})})}function Xr(){var e,t,s,r,n,i,o,a,l,c,d,h,p,m,g;const{slug:v}=q(),{projects:b}=Y(),y=b.find(e=>e.slug===v),[x,w]=f.useState(!1),[_,j]=f.useState("CM"),[S,N]=f.useState(null);return f.useEffect(()=>{window.scrollTo(0,0)},[v]),f.useEffect(()=>{(()=>{u(this,null,function*(){try{const{data:e,error:t}=yield Br.from("global_users").select("username, profile_photo_url").eq("email","romainfalanga83@gmail.com").single();t?(console.error("Erreur lors du chargement du profil CEO:",t),N({username:"Romain Falanga",profile_photo_url:"/profile-photos/RomainFalanga.jpeg"})):N(e)}catch(e){console.error("Erreur:",e),N({username:"Romain Falanga",profile_photo_url:"/profile-photos/RomainFalanga.jpeg"})}})})()},[]),y?K.jsxs("div",{className:"min-h-screen py-6 sm:py-8 px-4",children:[K.jsxs("div",{className:"max-w-6xl mx-auto",children:[K.jsx("div",{className:"mb-6 sm:mb-8",children:K.jsxs(D,{to:"/",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors text-sm sm:text-base",children:[K.jsx(C,{className:"h-5 w-5"}),K.jsx("span",{children:"Retour à l'accueil"})]})}),K.jsx("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg p-4 sm:p-6 lg:p-8 mb-6 sm:mb-8",children:K.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 sm:gap-8 items-center",children:[K.jsxs("div",{children:[K.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 mb-3 sm:mb-4",children:y.name}),K.jsx("p",{className:"text-base sm:text-lg text-gray-700 leading-relaxed mb-4 sm:mb-6",children:y.description.split("\n").map((e,t)=>K.jsxs("span",{children:[e,t<y.description.split("\n").length-1&&K.jsx("br",{})]},t))})]}),K.jsx("div",{className:"flex justify-center order-first md:order-last",children:K.jsx("img",{src:y.image,alt:y.name,className:"w-48 h-48 sm:w-56 sm:h-56 md:w-64 md:h-64 object-cover object-center bg-gray-100 rounded-xl sm:rounded-2xl shadow-lg"})})]})}),K.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6 sm:mb-8",children:[K.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[K.jsx(O,{className:"h-6 w-6 sm:h-8 sm:w-8 text-blue-600"}),K.jsx("h2",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"L'équipe du projet"})]}),K.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-4",children:[K.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 p-3 sm:p-4 rounded-lg border border-blue-100 text-center",children:[K.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full overflow-hidden mx-auto mb-3 shadow-lg",children:K.jsx("img",{src:(null==S?void 0:S.profile_photo_url)||"/profile-photos/RomainFalanga.jpeg",alt:(null==S?void 0:S.username)||"CEO",className:"w-full h-full object-cover",onError:e=>{const t=e.target;"/profile-photos/RomainFalanga.jpeg"!==t.src&&(t.src="/profile-photos/RomainFalanga.jpeg")}})}),K.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-900",children:"CEO"}),K.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Directeur général"}),K.jsx("p",{className:"text-gray-700 font-medium text-xs sm:text-sm mt-1 sm:mt-1",children:(null==S?void 0:S.username)||"Romain Falanga"}),K.jsx(D,{to:"/profile",className:"mt-2 inline-block text-sm sm:text-sm bg-blue-600 text-white px-4 sm:px-4 py-2.5 sm:py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-md hover:shadow-lg transform hover:scale-105",children:"Voir le profil"})]}),K.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 p-3 sm:p-4 rounded-lg border border-purple-100 text-center",children:[(null==(e=y.cm1)?void 0:e.name)&&"Recherche active"!==(null==(t=y.cm1)?void 0:t.name)?K.jsxs("div",{className:"relative p-3 sm:p-4 bg-gradient-to-br from-purple-500 via-pink-600 to-rose-700 rounded-xl w-fit mx-auto mb-3 shadow-lg",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent rounded-xl"}),K.jsx(I,{className:"h-6 w-6 sm:h-7 sm:w-7 text-white relative z-10"})]}):K.jsxs("div",{className:"relative p-3 sm:p-4 bg-gradient-to-br from-gray-400 via-gray-500 to-gray-600 rounded-xl w-fit mx-auto mb-3 shadow-lg",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent rounded-xl"}),K.jsx(A,{className:"h-6 w-6 sm:h-7 sm:w-7 text-white relative z-10"})]}),K.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-900",children:"CM 1"}),K.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Community Manager"}),K.jsx("p",{className:"text-gray-700 font-medium text-xs sm:text-sm",children:(null==(s=y.cm1)?void 0:s.name)||"Recherche active"}),(!(null==(r=y.cm1)?void 0:r.name)||"Recherche active"===(null==(n=y.cm1)?void 0:n.name))&&K.jsx("button",{onClick:()=>{j("CM"),w(!0)},className:"mt-2 sm:mt-3 text-sm sm:text-sm bg-blue-600 text-white px-4 sm:px-4 py-2.5 sm:py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-md hover:shadow-lg transform hover:scale-105",children:"Postuler"})]}),K.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 p-3 sm:p-4 rounded-lg border border-purple-100 text-center",children:[(null==(i=y.cm2)?void 0:i.name)&&"Recherche active"!==(null==(o=y.cm2)?void 0:o.name)?K.jsxs("div",{className:"relative p-3 sm:p-4 bg-gradient-to-br from-purple-500 via-pink-600 to-rose-700 rounded-xl w-fit mx-auto mb-3 shadow-lg",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent rounded-xl"}),K.jsx(I,{className:"h-6 w-6 sm:h-7 sm:w-7 text-white relative z-10"})]}):K.jsxs("div",{className:"relative p-3 sm:p-4 bg-gradient-to-br from-gray-400 via-gray-500 to-gray-600 rounded-xl w-fit mx-auto mb-3 shadow-lg",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent rounded-xl"}),K.jsx(A,{className:"h-6 w-6 sm:h-7 sm:w-7 text-white relative z-10"})]}),K.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-900",children:"CM 2"}),K.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Community Manager"}),K.jsx("p",{className:"text-gray-700 font-medium text-xs sm:text-sm",children:(null==(a=y.cm2)?void 0:a.name)||"Recherche active"}),(!(null==(l=y.cm2)?void 0:l.name)||"Recherche active"===(null==(c=y.cm2)?void 0:c.name))&&K.jsx("button",{onClick:()=>{j("CM"),w(!0)},className:"mt-2 sm:mt-3 text-sm sm:text-sm bg-blue-600 text-white px-4 sm:px-4 py-2.5 sm:py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-md hover:shadow-lg transform hover:scale-105",children:"Postuler"})]}),K.jsxs("div",{className:"bg-gradient-to-br from-purple-50 to-pink-50 p-3 sm:p-4 rounded-lg border border-purple-100 text-center",children:[(null==(d=y.cm3)?void 0:d.name)&&"Recherche active"!==(null==(h=y.cm3)?void 0:h.name)?K.jsxs("div",{className:"relative p-3 sm:p-4 bg-gradient-to-br from-purple-500 via-pink-600 to-rose-700 rounded-xl w-fit mx-auto mb-3 shadow-lg",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent rounded-xl"}),K.jsx(I,{className:"h-6 w-6 sm:h-7 sm:w-7 text-white relative z-10"})]}):K.jsxs("div",{className:"relative p-3 sm:p-4 bg-gradient-to-br from-gray-400 via-gray-500 to-gray-600 rounded-xl w-fit mx-auto mb-3 shadow-lg",children:[K.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent rounded-xl"}),K.jsx(A,{className:"h-6 w-6 sm:h-7 sm:w-7 text-white relative z-10"})]}),K.jsx("h3",{className:"text-base sm:text-lg font-bold text-gray-900",children:"CM 3"}),K.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Community Manager"}),K.jsx("p",{className:"text-gray-700 font-medium text-xs sm:text-sm",children:(null==(p=y.cm3)?void 0:p.name)||"Recherche active"}),(!(null==(m=y.cm3)?void 0:m.name)||"Recherche active"===(null==(g=y.cm3)?void 0:g.name))&&K.jsx("button",{onClick:()=>{j("CM"),w(!0)},className:"mt-2 sm:mt-3 text-sm sm:text-sm bg-blue-600 text-white px-4 sm:px-4 py-2.5 sm:py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-md hover:shadow-lg transform hover:scale-105",children:"Postuler"})]})]}),K.jsx("div",{className:"mt-4 text-center",children:K.jsxs("a",{href:y.telegramUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center justify-center w-full sm:w-auto space-x-2 bg-gradient-to-r from-cyan-600 to-blue-600 text-white px-6 sm:px-8 py-3 rounded-lg hover:from-cyan-700 hover:to-blue-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl transform hover:scale-105 text-sm sm:text-base",children:[K.jsx(I,{className:"h-5 w-5"}),K.jsx("span",{children:"Rejoindre le Telegram"})]})})]}),K.jsx("div",{className:"mb-8 sm:mb-12",children:K.jsx("a",{href:y.websiteUrl,target:"_blank",rel:"noopener noreferrer",className:"group bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 sm:p-8 rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 hover:shadow-xl block w-full",children:K.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[K.jsx(k,{className:"h-6 w-6 sm:h-8 sm:w-8"}),K.jsxs("span",{className:"text-xl sm:text-2xl font-bold",children:["Accéder à ",y.name]})]})})})]}),K.jsx(Zr,{isOpen:x,onClose:()=>w(!1),projectName:y.name,preselectedPosition:_})]}):K.jsx("div",{className:"min-h-screen flex items-center justify-center",children:K.jsxs("div",{className:"text-center",children:[K.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Projet non trouvé"}),K.jsx(D,{to:"/",className:"text-blue-600 hover:text-blue-700",children:"Retour à l'accueil"})]})})}function Qr(){var e;const{user:t,signOut:s}=Kr(),{globalUser:r,siteProfile:n,loading:i,error:o,updateGlobalProfile:a,updateSiteProfile:d}=Vr("romainflg"),[h,p]=f.useState(!1),[m,v]=f.useState({username:"",description:"",profile_photo_url:""}),[b,y]=f.useState(!1),[x,w]=f.useState(null),[_,j]=f.useState(!1);return f.useEffect(()=>{window.scrollTo(0,0)},[]),f.useEffect(()=>{r&&n&&v({username:r.username,description:n.description,profile_photo_url:r.profile_photo_url})},[r,n]),t?i?K.jsx("div",{className:"min-h-screen flex items-center justify-center",children:K.jsxs("div",{className:"text-center",children:[K.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),K.jsx("p",{className:"text-gray-600",children:"Chargement du profil..."})]})}):o?K.jsx("div",{className:"min-h-screen flex items-center justify-center",children:K.jsxs("div",{className:"text-center",children:[K.jsx("h2",{className:"text-2xl font-bold text-red-600 mb-4",children:"Erreur"}),K.jsx("p",{className:"text-gray-600 mb-4",children:o}),K.jsx(D,{to:"/",className:"text-blue-600 hover:text-blue-700",children:"Retour à l'accueil"})]})}):K.jsx("div",{className:"min-h-screen py-6 sm:py-8 px-4",children:K.jsxs("div",{className:"max-w-4xl mx-auto",children:[K.jsx("div",{className:"mb-6 sm:mb-8",children:K.jsxs(D,{to:"/",className:"flex items-center space-x-2 text-gray-600 hover:text-gray-800 transition-colors text-sm sm:text-base",children:[K.jsx(C,{className:"h-5 w-5"}),K.jsx("span",{children:"Retour à l'accueil"})]})}),K.jsxs("div",{className:"bg-white rounded-xl sm:rounded-2xl shadow-lg overflow-hidden mb-6 sm:mb-8",children:[K.jsx("div",{className:"h-32 sm:h-48 bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-800 relative",children:K.jsx("div",{className:"absolute inset-0 bg-black/20"})}),K.jsxs("div",{className:"relative px-4 sm:px-6 lg:px-8 pb-6 sm:pb-8",children:[K.jsx("div",{className:"flex justify-center -mt-12 sm:-mt-16 mb-4 sm:mb-6",children:K.jsxs("div",{className:"relative",children:[K.jsx("input",{type:"file",id:"profile-photo-upload",accept:"image/*",onChange:e=>u(this,null,function*(){var s;const r=null==(s=e.target.files)?void 0:s[0];if(r){if(console.log("📁 Fichier sélectionné:",r.name,r.type,r.size),!r.type.startsWith("image/"))return void w("Veuillez sélectionner un fichier image valide");if(r.size>5242880)return void w("L'image ne doit pas dépasser 5MB");j(!0),w(null);try{const e=r.name.split(".").pop(),s=`user-${null==t?void 0:t.id}-${Date.now()}.${e}`;console.log("📝 Nom de fichier généré:",s),console.log("☁️ Tentative d'upload vers Supabase Storage...");const{data:n,error:i}=yield Br.storage.from("profile-photos").upload(s,r,{cacheControl:"3600",upsert:!0});if(i)throw console.error("❌ Erreur upload Supabase:",i),new Error(`Erreur upload: ${i.message}`);const{data:{publicUrl:o}}=Br.storage.from("profile-photos").getPublicUrl(s);console.log("✅ Upload réussi ! URL Supabase:",o),v(c(l({},m),{profile_photo_url:o}))}catch(n){console.error("❌ Erreur lors de l'upload:",n),w(`Impossible d'uploader l'image: ${n.message}`)}finally{j(!1)}}}),className:"hidden"}),K.jsx("img",{src:m.profile_photo_url||"/profile-photos/default-avatar.png",alt:m.username,className:"w-24 h-24 sm:w-32 sm:h-32 rounded-full border-4 border-white shadow-lg object-cover",onError:e=>{const t=e.target;"/profile-photos/default-avatar.png"!==t.src&&(t.src="/profile-photos/default-avatar.png")}}),h&&K.jsx("button",{onClick:()=>{var e;return null==(e=document.getElementById("profile-photo-upload"))?void 0:e.click()},disabled:_,className:"absolute -bottom-1 -right-1 w-8 h-8 sm:w-10 sm:h-10 bg-blue-600 rounded-full border-2 border-white flex items-center justify-center hover:bg-blue-700 transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:_?K.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):K.jsx(R,{className:"h-4 w-4 text-white"})}),!h&&K.jsx("div",{className:"absolute -bottom-1 -right-1 w-6 h-6 sm:w-8 sm:h-8 bg-green-500 rounded-full border-2 border-white"})]})}),K.jsxs("div",{className:"text-center mb-4 sm:mb-6",children:[K.jsxs("div",{className:"flex items-center justify-center space-x-3 mb-4",children:[h?K.jsx("input",{type:"text",value:m.username,onChange:e=>v(c(l({},m),{username:e.target.value})),className:"text-2xl sm:text-3xl font-bold text-gray-900 text-center bg-transparent border-b-2 border-blue-500 focus:outline-none focus:border-blue-600",placeholder:"Nom d'utilisateur"}):K.jsx("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900",children:null==r?void 0:r.username}),!h&&K.jsx("button",{onClick:()=>p(!0),className:"p-2 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",children:K.jsx($,{className:"h-5 w-5"})})]}),K.jsxs("div",{className:"mb-4",children:[K.jsx("p",{className:"text-sm text-blue-600 bg-blue-50 px-4 py-2 rounded-lg inline-block",children:"🌐 Ce nom d'utilisateur et cette photo sont partagés sur toutes les plateformes Romain FLG"}),(null==(e=m.profile_photo_url)?void 0:e.startsWith("/profile-photos/"))&&K.jsx("p",{className:"text-sm text-amber-600 bg-amber-50 px-4 py-2 rounded-lg inline-block mt-2",children:"📁 Photo actuelle stockée localement - Uploadez une nouvelle photo pour migrer vers le cloud"})]}),K.jsxs("div",{className:"max-w-3xl mx-auto mt-6",children:[K.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"À propos"}),K.jsx("div",{className:"prose prose-lg max-w-none text-left",children:h?K.jsx("textarea",{value:m.description,onChange:e=>v(c(l({},m),{description:e.target.value})),rows:8,className:"w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none text-gray-700",placeholder:"Parlez-nous de vous, vos passions, vos projets..."}):K.jsx("div",{className:"text-gray-700 leading-relaxed whitespace-pre-wrap",children:(null==n?void 0:n.description)||K.jsx("div",{className:"text-gray-500 italic",children:"Aucune description ajoutée. Cliquez sur le bouton modifier pour ajouter une description."})})})]}),x&&K.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:K.jsx("p",{className:"text-red-800 text-sm",children:x})}),h?K.jsxs("div",{className:"flex justify-center space-x-4 mt-6",children:[K.jsxs("button",{onClick:()=>{r&&n&&v({username:r.username,description:n.description,profile_photo_url:r.profile_photo_url}),p(!1),w(null)},disabled:b,className:"flex items-center space-x-2 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50",children:[K.jsx(g,{className:"h-5 w-5"}),K.jsx("span",{children:"Annuler"})]}),K.jsxs("button",{onClick:()=>u(this,null,function*(){if(r&&n){y(!0),w(null);try{m.username===r.username&&m.profile_photo_url===r.profile_photo_url||(yield a({username:m.username.trim(),profile_photo_url:m.profile_photo_url})),m.description!==n.description&&(yield d({description:m.description.trim()})),p(!1)}catch(e){console.error("Erreur lors de la sauvegarde:",e),w(e.message||"Erreur lors de la sauvegarde")}finally{y(!1)}}}),disabled:b,className:"flex items-center space-x-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 font-medium shadow-lg hover:shadow-xl disabled:opacity-50",children:[b?K.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}):K.jsx(U,{className:"h-5 w-5"}),K.jsx("span",{children:b?"Sauvegarde...":"Sauvegarder"})]})]}):K.jsx("div",{className:"flex justify-center mt-6",children:K.jsxs("button",{onClick:()=>u(this,null,function*(){yield s()}),className:"flex items-center space-x-2 text-red-600 hover:text-red-700 hover:bg-red-50 px-6 py-3 rounded-lg transition-colors font-medium",children:[K.jsx(L,{className:"h-5 w-5"}),K.jsx("span",{children:"Se déconnecter"})]})})]})]})]})]})}):K.jsx("div",{className:"min-h-screen flex items-center justify-center",children:K.jsxs("div",{className:"text-center",children:[K.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Accès non autorisé"}),K.jsx("p",{className:"text-gray-600 mb-4",children:"Vous devez être connecté pour accéder à cette page."}),K.jsx(D,{to:"/",className:"text-blue-600 hover:text-blue-700",children:"Retour à l'accueil"})]})})}function en(){return K.jsx(Wr,{children:K.jsx(H,{children:K.jsx(M,{children:K.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50",children:[K.jsx(Hr,{}),K.jsx("main",{className:"pt-16",children:K.jsxs(z,{children:[K.jsx(B,{path:"/",element:K.jsx(Yr,{})}),K.jsx(B,{path:"/project/:slug",element:K.jsx(Xr,{})}),K.jsx(B,{path:"/profile",element:K.jsx(Qr,{})})]})})]})})})})}W(document.getElementById("root")).render(K.jsx(d.StrictMode,{children:K.jsx(en,{})}))}},function(){return J||(0,F[r(F)[0]])((J={exports:{}}).exports,J),J.exports});export default W();
